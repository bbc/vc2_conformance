
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VC-2 encoder conformance testing procedure &#8212; SMPTE VC-2 Conformance Software v0.4.7 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Testing additional bitstreams’ conformance" href="bitstream_testing.html" />
    <link rel="prev" title="VC-2 decoder conformance testing procedure" href="decoder_testing.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="bitstream_testing.html" title="Testing additional bitstreams’ conformance"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="decoder_testing.html" title="VC-2 decoder conformance testing procedure"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SMPTE VC-2 Conformance Software v0.4.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">User’s guide (for codec testers)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">VC-2 encoder conformance testing procedure</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="vc-2-encoder-conformance-testing-procedure">
<span id="guide-encoder-testing"></span><h1>VC-2 encoder conformance testing procedure<a class="headerlink" href="#vc-2-encoder-conformance-testing-procedure" title="Permalink to this headline">¶</a></h1>
<p>The VC-2 encoder conformance testing procedure is described below. In summary,
the raw video test sequences generated in the
<a class="reference internal" href="generating_test_cases.html#guide-generating-test-cases"><span class="std std-ref">Generating test cases</span></a> step will be encoded using the candidate
encoder. The resulting bitstream will then be checked using the
<a class="reference internal" href="../cli/vc2_bitstream_validator.html#vc2-bitstream-validator"><span class="std std-ref">vc2-bitstream-validator</span></a> and encoded pictures compared with the originals
for similarity.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Whilst it is possible to carry out the encoder testing procedure manually,
we recommend producing a script to automate most of the steps required for
the particular encoder being tested. You must still take care to manually
inspect and compare all decoded pictures, however.</p>
</div>
<div class="section" id="encoding-the-reference-bitstreams">
<h2>Encoding the reference bitstreams<a class="headerlink" href="#encoding-the-reference-bitstreams" title="Permalink to this headline">¶</a></h2>
<p>For each codec feature set provided, a set of raw videos are produced. These
are located in directories matching the pattern <code class="docutils literal notranslate"><span class="pre">&lt;codec</span> <span class="pre">feature</span> <span class="pre">set</span>
<span class="pre">name&gt;/encoder/&lt;test-case-name&gt;/</span></code>. The specific test cases generated will vary
depending on the codec features specified.</p>
<p>Each test case must be encoded independently by the encoder under test and the
encoded bitstreams stored on disk. The encoder must not crash or produce any
warnings when encoding these test sequences.</p>
</div>
<div class="section" id="checking-the-encoded-bitstreams">
<h2>Checking the encoded bitstreams<a class="headerlink" href="#checking-the-encoded-bitstreams" title="Permalink to this headline">¶</a></h2>
<p>Each encoded bitstream must be checked with the <a class="reference internal" href="../cli/vc2_bitstream_validator.html#vc2-bitstream-validator"><span class="std std-ref">vc2-bitstream-validator</span></a>.
This tool simultaneously verifies that the bitstream meets the requirements of
the VC-2 specification and provides a reference decoding of the stream.</p>
<p>The tool takes a VC-2 bitstream as argument and optionally an output name for
the decoded pictures, as illustrated below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir real_pictures_decoded
$ vc2-bitstream-validator \
    real_pictures.vc2 \
    --output real_pictures_decoded/picture_%d.raw
</pre></div>
</div>
<p>If the bitstream is valid, the following message will be produced:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>No errors found in bitstream. Verify decoded pictures to confirm conformance.
</pre></div>
</div>
<p>Otherwise, if a conformance error is found, processing will stop and a detailed
error message will be produced explaining the problem.</p>
<p>Once a bitstream has been validated and decoded using
<a class="reference internal" href="../cli/vc2_bitstream_validator.html#vc2-bitstream-validator"><span class="std std-ref">vc2-bitstream-validator</span></a>, the <a class="reference internal" href="../cli/vc2_picture_compare.html#vc2-picture-compare"><span class="std std-ref">vc2-picture-compare</span></a> command is used
to compare the output against the original pictures. The script must be
provided with two raw picture filenames, or two directory names containing raw
pictures.  One should contain the original images, and the other its encoded
then decoded counterpart. The similarity of the images will be reported. For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vc2-picture-compare real_pictures/ real_pictures_decoded/
Comparing real_pictures/picture_0.raw and real_pictures_decoded/picture_0.raw
  Pictures are different:
    Y: Different: PSNR = 55.6 dB, 1426363 pixels (68.8%) differ
    C1: Different: PSNR = 57.7 dB, 662607 pixels (63.9%) differ
    C2: Different: PSNR = 56.8 dB, 703531 pixels (67.9%) differ
Comparing real_pictures/picture_1.raw and real_pictures_decoded/picture_1.raw
  Pictures are different:
    Y: Different: PSNR = 55.6 dB, 1426363 pixels (68.8%) differ
    C1: Different: PSNR = 57.7 dB, 662607 pixels (63.9%) differ
    C2: Different: PSNR = 56.8 dB, 703531 pixels (67.9%) differ
Comparing real_pictures/picture_2.raw and real_pictures_decoded/picture_2.raw
  Pictures are different:
    Y: Different: PSNR = 55.6 dB, 1426363 pixels (68.8%) differ
    C1: Different: PSNR = 57.7 dB, 662607 pixels (63.9%) differ
    C2: Different: PSNR = 56.8 dB, 703531 pixels (67.9%) differ
Summary: 0 identical, 3 different
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When provided with two directories to compare the
<a class="reference internal" href="../cli/vc2_picture_compare.html#vc2-picture-compare"><span class="std std-ref">vc2-picture-compare</span></a> tool will ignore all but the numercial part of
the filenames when matching pictures together. Differing names or uses (and
non-uses) of leading zeros are ignored. For example, it would compare two
files named <code class="docutils literal notranslate"><span class="pre">expected/picture_12.raw</span></code> and <code class="docutils literal notranslate"><span class="pre">actual/image_0012.raw</span></code>.</p>
</div>
<p>For a test case to pass:</p>
<ul class="simple">
<li><p>The encoder must not raise an error condition during encoding.</p></li>
<li><p>The <a class="reference internal" href="../cli/vc2_bitstream_validator.html#vc2-bitstream-validator"><span class="std std-ref">vc2-bitstream-validator</span></a> must not find any errors in the bit stream.</p></li>
<li><p>For lossless encoders, <a class="reference internal" href="../cli/vc2_picture_compare.html#vc2-picture-compare"><span class="std std-ref">vc2-picture-compare</span></a> tool must report <code class="docutils literal notranslate"><span class="pre">Pictures</span> <span class="pre">are</span>
<span class="pre">identical</span></code>, with no warnings, for every picture in the reference decoding.</p></li>
<li><p>For lossy encoders, <a class="reference internal" href="../cli/vc2_picture_compare.html#vc2-picture-compare"><span class="std std-ref">vc2-picture-compare</span></a> tool might report a difference
and the quoted PSNR figure should be checked to ensure it is appropriate for
the intended application of the codec.</p></li>
<li><p>Input and output pictures must be visually compared and should be
sufficiently similar as to be suitable for the intended application of the
codec.</p></li>
<li><p>No additional pictures must have been decoded.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When viewing pictures using the <code class="docutils literal notranslate"><span class="pre">ffplay</span></code> commands suggested by
<a class="reference internal" href="../cli/vc2_picture_explain.html#vc2-picture-explain"><span class="std std-ref">vc2-picture-explain</span></a> you might sometimes find it helpful to use a
very low frame rate or playback the sequence in a loop.</p>
<p>To reduce the frame rate such that each frame is shown for 5 seconds,
replace the value after <code class="docutils literal notranslate"><span class="pre">-framerate</span></code> with <code class="docutils literal notranslate"><span class="pre">1/5</span></code>.</p>
<p>To loop the sequence indefinately add <code class="docutils literal notranslate"><span class="pre">-loop</span> <span class="pre">0</span></code> to the command.</p>
</div>
<p>For an encoder to pass the conformance test, all test cases, for all supported
codec feature sets must pass. If any tests fail, this indicates that the
encoder is non-conformant to the VC-2 specification.</p>
<p>The section below outlines the purpose of each test case and gives advice on
what that case failing might indicate.</p>
</div>
<div class="section" id="encoder-test-cases">
<span id="id1"></span><h2>Encoder test cases<a class="headerlink" href="#encoder-test-cases" title="Permalink to this headline">¶</a></h2>
<p>The purpose of each test case (or group of test cases), along with advice on
debugging failing tests is provided below.</p>
<div class="section" id="test-case-encoder-real_pictures">
<span id="std-encoder-test-case-real_pictures"></span><span id="std:encoder-test-case-real_pictures"></span><h3>Encoder test case: <code class="docutils literal notranslate"><span class="pre">real_pictures</span></code><a class="headerlink" href="#test-case-encoder-real_pictures" title="Permalink to this headline">¶</a></h3>
<p><strong>Tests real pictures are encoded sensibly.</strong></p>
<p>This test contains a series of three still photographs of natural scenes
with varying levels of high and low spatial frequency content.</p>
<img alt="../_images/real_pictures.svg" src="../_images/real_pictures.svg" /><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The source images for this test case are generated from 4256 by 2832
pixel, 4:4:4, 16 bit, standard dynamic range, RGB color images with the
ITU-R BT.709 gamut. As such, the pictures might be of reduced technical
quality compared with the capabilities of the format. The rescaling and
color conversion algorithms used are also basic in nature, potentially
further reducing the picture quality.</p>
</div>
</div>
<div class="section" id="test-case-encoder-signal_range">
<span id="std-encoder-test-case-signal_range"></span><span id="std:encoder-test-case-signal_range"></span><h3>Encoder test case: <code class="docutils literal notranslate"><span class="pre">signal_range</span></code><a class="headerlink" href="#test-case-encoder-signal_range" title="Permalink to this headline">¶</a></h3>
<p><strong>Tests that an encoder has sufficient numerical dynamic range.</strong></p>
<p>These test cases contain test patterns designed to produce extreme signals
within encoders. During these test cases, no integer clamping or overflows
must occur.</p>
<p>A test case is produced for each picture component:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">signal_range[Y]</span></code></dt><dd><p>Luma component test patterns.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">signal_range[C1]</span></code></dt><dd><p>Color difference 1 component test patterns.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">signal_range[C2]</span></code></dt><dd><p>Color difference 2 component test patterns.</p>
</dd>
</dl>
<p>Though the test patterns produce near worst case signal levels, they are
not guaranteed to produce the largest values possible.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For informational purposes, an example of a set of test patterns are shown below:</p>
<img alt="../_images/signal_range_encoder.png" src="../_images/signal_range_encoder.png" />
</div>
<p>An informative metadata file is provided along side each test case which
gives, for each picture in the bitstream, the parts of a encoder which are
being tested by the test patterns. See
<a class="reference external" href="https://bbc.github.io/vc2_bit_widths/high_level_api/helpers.html#vc2_bit_widths.helpers.TestPoint" title="(in SMPTE ST 2042-1 (VC-2) Bit Widths v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">vc2_bit_widths.helpers.TestPoint</span></code></a> for details.</p>
</div>
<div class="section" id="test-case-encoder-synthetic_gray">
<span id="std-encoder-test-case-synthetic_gray"></span><span id="std:encoder-test-case-synthetic_gray"></span><h3>Encoder test case: <code class="docutils literal notranslate"><span class="pre">synthetic_gray</span></code><a class="headerlink" href="#test-case-encoder-synthetic_gray" title="Permalink to this headline">¶</a></h3>
<p><strong>Tests that the encoder can encode a maximally compressible sequence.</strong></p>
<p>This sequence contains an image in which every transform coefficient is
zero. For most color specifications (11.4.10), this decodes to a mid-gray
frame.</p>
<p>This special case image is maximally compressible since no transform
coefficients need to be explicitly coded in the bitstream. For lossless
coding modes, this should also produce produce the smallest possible
bitstream.</p>
</div>
<div class="section" id="test-case-encoder-synthetic_linear_ramps">
<span id="std-encoder-test-case-synthetic_linear_ramps"></span><span id="std:encoder-test-case-synthetic_linear_ramps"></span><h3>Encoder test case: <code class="docutils literal notranslate"><span class="pre">synthetic_linear_ramps</span></code><a class="headerlink" href="#test-case-encoder-synthetic_linear_ramps" title="Permalink to this headline">¶</a></h3>
<p><strong>Tests that an encoder correctly encodes color specification
information.</strong></p>
<p>A static frame containing linear signal ramps for white and primary
red, green and blue (in that order, from top-to-bottom) as illustrated
below:</p>
<img alt="../_images/static_ramps.png" src="../_images/static_ramps.png" />
<p>The red, green and blue colors correspond to the red, green and blue
primaries for the color specification (11.4.10.2).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When D-Cinema primaries are specified (preset color primaries index 3),
red, green and blue are replaced with CIE X, Y and Z respectively. Note
that these might not represent physically realisable colors.</p>
</div>
<p>The left-most pixels in each band are video black and the right-most pixels
video white, red, green and blue (respectively). That is, oversaturated
signals (e.g. ‘super-blacks’ and ‘super-white’) are not included.</p>
<p>The value ramps in the test picture are linear meaning that the (linear)
pixel values increase at a constant rate from left (black) to right
(saturated white/red/green/blue). Due to the non-linear response of human
vision, this will produce a non-linear brightness ramp which appears to
quickly saturate. Further, when a non-linear transfer function is specified
(11.4.10.4) the raw picture values will not be linearly spaced.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When the D-Cinema transfer function is specified (preset transfer
function index 3), the saturated signals do not correspond to a
non-linear signal value of 1.0 but instead approximately 0.97. This is
because the D-Cinema transfer function allocates part of its nominal
output range to over-saturated signals.</p>
</div>
</div>
<div class="section" id="test-case-encoder-synthetic_moving_sprite">
<span id="std-encoder-test-case-synthetic_moving_sprite"></span><span id="std:encoder-test-case-synthetic_moving_sprite"></span><h3>Encoder test case: <code class="docutils literal notranslate"><span class="pre">synthetic_moving_sprite</span></code><a class="headerlink" href="#test-case-encoder-synthetic_moving_sprite" title="Permalink to this headline">¶</a></h3>
<p><strong>Tests that an encoder produces sensible results for motion.</strong></p>
<p>A sequence of 10 frames containing a graphic moving from left to right
along the top of the frame. In successive each frame, the graphic moves
16 luma samples to the right (i.e. 8 samples every field, for
interlaced formats).</p>
<img alt="../_images/interlace_mode_and_pixel_aspect_ratio_moving_sequence.svg" src="../_images/interlace_mode_and_pixel_aspect_ratio_moving_sequence.svg" /><p>For progressive formats, the graphic should appear with smooth edges in
each frame.</p>
<p>For interlaced formats, the graphic should move smoothly when displayed
on an interlaced monitor. If displayed as progressive frames (as in the
illustration above), the pictures will appear to have ragged edges.</p>
</div>
<div class="section" id="test-case-encoder-synthetic_noise">
<span id="std-encoder-test-case-synthetic_noise"></span><span id="std:encoder-test-case-synthetic_noise"></span><h3>Encoder test case: <code class="docutils literal notranslate"><span class="pre">synthetic_noise</span></code><a class="headerlink" href="#test-case-encoder-synthetic_noise" title="Permalink to this headline">¶</a></h3>
<p><strong>Tests that an encoder correctly encodes a noise plate.</strong></p>
<p>A static frame containing pseudo-random uniform noise as illustrated below:</p>
<img alt="../_images/noise.png" src="../_images/noise.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is likely that lossy encoders will be unable to compress this test
case without a fairly significant loss of fidelity. As such, it is
acceptable for this test case for an encoder to produce only visually
similar results.</p>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">VC-2 encoder conformance testing procedure</a><ul>
<li><a class="reference internal" href="#encoding-the-reference-bitstreams">Encoding the reference bitstreams</a></li>
<li><a class="reference internal" href="#checking-the-encoded-bitstreams">Checking the encoded bitstreams</a></li>
<li><a class="reference internal" href="#encoder-test-cases">Encoder test cases</a><ul>
<li><a class="reference internal" href="#test-case-encoder-real_pictures">Encoder test case: <code class="docutils literal notranslate"><span class="pre">real_pictures</span></code></a></li>
<li><a class="reference internal" href="#test-case-encoder-signal_range">Encoder test case: <code class="docutils literal notranslate"><span class="pre">signal_range</span></code></a></li>
<li><a class="reference internal" href="#test-case-encoder-synthetic_gray">Encoder test case: <code class="docutils literal notranslate"><span class="pre">synthetic_gray</span></code></a></li>
<li><a class="reference internal" href="#test-case-encoder-synthetic_linear_ramps">Encoder test case: <code class="docutils literal notranslate"><span class="pre">synthetic_linear_ramps</span></code></a></li>
<li><a class="reference internal" href="#test-case-encoder-synthetic_moving_sprite">Encoder test case: <code class="docutils literal notranslate"><span class="pre">synthetic_moving_sprite</span></code></a></li>
<li><a class="reference internal" href="#test-case-encoder-synthetic_noise">Encoder test case: <code class="docutils literal notranslate"><span class="pre">synthetic_noise</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="decoder_testing.html"
                        title="previous chapter">VC-2 decoder conformance testing procedure</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="bitstream_testing.html"
                        title="next chapter">Testing additional bitstreams’ conformance</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user_guide/encoder_testing.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="bitstream_testing.html" title="Testing additional bitstreams’ conformance"
             >next</a> |</li>
        <li class="right" >
          <a href="decoder_testing.html" title="VC-2 decoder conformance testing procedure"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SMPTE VC-2 Conformance Software v0.4.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >User’s guide (for codec testers)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">VC-2 encoder conformance testing procedure</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, BBC.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.3.
    </div>
  </body>
</html>