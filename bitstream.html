
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>vc2_conformance.bitstream: Bitstream manipulation module &#8212; SMPTE VC-2 Conformance Software v1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Test picture generation reference" href="picture_generation/index.html" />
    <link rel="prev" title="vc2_conformance.encoder: Internal VC-2 encoder" href="encoder.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="picture_generation/index.html" title="Test picture generation reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="encoder.html" title="vc2_conformance.encoder: Internal VC-2 encoder"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SMPTE VC-2 Conformance Software v1.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream</span></code>: Bitstream manipulation module</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-vc2_conformance.bitstream">
<span id="vc2-conformance-bitstream-bitstream-manipulation-module"></span><span id="maintainer-bitstream"></span><h1><a class="reference internal" href="#module-vc2_conformance.bitstream" title="vc2_conformance.bitstream"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream</span></code></a>: Bitstream manipulation module<a class="headerlink" href="#module-vc2_conformance.bitstream" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="#module-vc2_conformance.bitstream" title="vc2_conformance.bitstream"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream</span></code></a> module implements facilities for
deserialising, displaying, manipulating and serialising VC-2 bitstreams,
including non-conformant streams, at a low-level.</p>
<p>This documentation begins with an overview of how bitstreams can be serialised,
deserialised and represented as Python data structures using this module. This
is followed by an in-depth description of how the serialiser and deserialisers
work internally.</p>
<div class="section" id="how-the-serialiser-deserialiser-module-is-used">
<h2>How the serialiser/deserialiser module is used<a class="headerlink" href="#how-the-serialiser-deserialiser-module-is-used" title="Permalink to this headline">¶</a></h2>
<p>This module is used by various parts of the VC-2 conformance software, for
example:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="cli/vc2_bitstream_viewer.html#vc2-bitstream-viewer"><span class="std std-ref">vc2-bitstream-viewer</span></a> utility uses this module to produce human
readable, hierarchical descriptions of bitstreams.</p></li>
<li><p>The test case generators in <a class="reference internal" href="test_case_generation/test_cases.html#module-vc2_conformance.test_cases" title="vc2_conformance.test_cases"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.test_cases</span></code></a> use this
module to manipulate bitstreams, for example by tweaking values or filling
padding bits with specific data.</p></li>
<li><p>The VC-2 encoder in <a class="reference internal" href="encoder.html#module-vc2_conformance.encoder" title="vc2_conformance.encoder"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.encoder</span></code></a> produces deserialised
bitstreams directly for later serialisation by this module.</p></li>
<li><p>The conformance software’s own test suite makes extensive use of this module.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This module is <em>not</em> used by the bitstream validator
(<a class="reference internal" href="decoder.html#module-vc2_conformance.decoder" title="vc2_conformance.decoder"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.decoder</span></code></a>) which instead operates directly on the
binary bitstream instead.</p>
</div>
<p>This module consists of two main parts: the
<a class="reference internal" href="#module-vc2_conformance.bitstream.serdes" title="vc2_conformance.bitstream.serdes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">serdes</span></code></a> framework for building serialisers
and deserialisers and a serialiser/deserialiser for VC-2.</p>
<p>The <a class="reference internal" href="#module-vc2_conformance.bitstream.serdes" title="vc2_conformance.bitstream.serdes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">serdes</span></code></a> framework allows serialisers
and deserialisers to be constructed <em>directly</em> from the VC-2 pseudocode,
ensuring a high chance of correctness.</p>
<p>The VC-2 serialiser/deserialiser, implemented using the
<a class="reference internal" href="#module-vc2_conformance.bitstream.serdes" title="vc2_conformance.bitstream.serdes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">serdes</span></code></a> framework defines a series of
Python data structures which may be used to describe a VC-2 bitstream.</p>
</div>
<div class="section" id="quick-start-guide">
<h2>Quick-start guide<a class="headerlink" href="#quick-start-guide" title="Permalink to this headline">¶</a></h2>
<p>Before diving into the details, we’ll briefly give few quick examples which
illustrate how this module is used below. We’ll show how a small bitstream can
be explicitly described as a Python data structure, serialised and then
deserialised again. We’ll skim over the details (and ignore a number of
important but minor features) in the process.</p>
<div class="section" id="deserialised-bitstream-data-structures">
<h3>Deserialised bitstream data structures<a class="headerlink" href="#deserialised-bitstream-data-structures" title="Permalink to this headline">¶</a></h3>
<p>A VC-2 bitstream can be described hierarchically as a series of dictionaries
and lists. For example, the following structure describes a minimal VC-2
bitstream containing just a single end-of-sequence data unit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bitarray</span> <span class="kn">import</span> <span class="n">bitarray</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># A minimal bitstream...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bitstream_description</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="c1"># ...consisting of a single sequence...</span>
<span class="gp">... </span>    <span class="s2">&quot;sequences&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span>
<span class="gp">... </span>            <span class="c1"># ...with a single data unit...</span>
<span class="gp">... </span>            <span class="s2">&quot;data_units&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">... </span>                <span class="p">{</span>
<span class="gp">... </span>                    <span class="c1"># ...which is an end-of-sequence data unit</span>
<span class="gp">... </span>                    <span class="s2">&quot;parse_info&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>                        <span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="n">bitarray</span><span class="p">(),</span>  <span class="c1"># No byte alignment bits</span>
<span class="gp">... </span>                        <span class="s2">&quot;parse_info_prefix&quot;</span><span class="p">:</span> <span class="mh">0x42424344</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="s2">&quot;parse_code&quot;</span><span class="p">:</span> <span class="mh">0x10</span><span class="p">,</span>  <span class="c1"># End of sequence</span>
<span class="gp">... </span>                        <span class="s2">&quot;next_parse_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="s2">&quot;previous_parse_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="p">},</span>
<span class="gp">... </span>                <span class="p">},</span>
<span class="gp">... </span>            <span class="p">],</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>To make this somewhat clearer and more robust, a set of <a class="reference internal" href="utility_modules/fixeddict.html#module-vc2_conformance.fixeddict" title="vc2_conformance.fixeddict"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fixeddicts</span></code></a> are provided which may be used instead of bare
Python dictionaries. The <a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#module-vc2_data_tables" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_data_tables</span></code></a> package also includes many
helpful constant definitions.  Together, these make it easier to see what’s
going on while also eliminating simple mistakes like misspelling a field name.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="utility_modules/fixeddict.html#module-vc2_conformance.fixeddict" title="vc2_conformance.fixeddict"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fixeddicts</span></code></a> are subclasses of Python’s
native <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> type with the following extra features:</p>
<ul class="simple">
<li><p>They allow only a permitted set of key names to be used.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">__str__</span></code> implementation produces an easier to read pretty-printed
format.</p></li>
</ul>
</div>
<p>Using these types, our example now looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">vc2_data_tables</span> <span class="kn">import</span> <span class="n">PARSE_INFO_PREFIX</span><span class="p">,</span> <span class="n">ParseCodes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">vc2_conformance.bitstream</span> <span class="kn">import</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">DataUnit</span><span class="p">,</span> <span class="n">ParseInfo</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">bitstream_description</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">sequences</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="n">Sequence</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">data_units</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>                <span class="n">DataUnit</span><span class="p">(</span>
<span class="gp">... </span>                    <span class="n">parse_info</span><span class="o">=</span><span class="n">ParseInfo</span><span class="p">(</span>
<span class="gp">... </span>                        <span class="n">padding</span><span class="o">=</span><span class="n">bitarray</span><span class="p">(),</span>  <span class="c1"># No byte alignment bits</span>
<span class="gp">... </span>                        <span class="n">parse_info_prefix</span><span class="o">=</span><span class="n">PARSE_INFO_PREFIX</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">parse_code</span><span class="o">=</span><span class="n">ParseCodes</span><span class="o">.</span><span class="n">end_of_sequence</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">next_parse_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">previous_parse_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="p">),</span>
<span class="gp">... </span>                <span class="p">),</span>
<span class="gp">... </span>            <span class="p">],</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#bitstream-fixeddicts"><span class="std std-ref">Deserialised VC-2 bitstream data types</span></a> for details of the expected hierarchy of a
deserialised bitstream (and the <a class="reference internal" href="utility_modules/fixeddict.html#module-vc2_conformance.fixeddict" title="vc2_conformance.fixeddict"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fixeddict</span></code></a> dictionary
types provided).</p>
</div>
<div class="section" id="serialising-bitstreams">
<h3>Serialising bitstreams<a class="headerlink" href="#serialising-bitstreams" title="Permalink to this headline">¶</a></h3>
<p>To serialise our bitstream into binary form, we can use the following (which
we’ll unpick afterwards):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">vc2_conformance.bitstream</span> <span class="kn">import</span> <span class="n">BitstreamWriter</span><span class="p">,</span> <span class="n">Serialiser</span><span class="p">,</span> <span class="n">parse_stream</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">vc2_conformance.pseudocode</span> <span class="kn">import</span> <span class="n">State</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/path/to/bitstream.vc2&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">Serialiser</span><span class="p">(</span><span class="n">BitstreamWriter</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">bitstream_description</span><span class="p">)</span> <span class="k">as</span> <span class="n">ser</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">parse_stream</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="n">State</span><span class="p">())</span>
</pre></div>
</div>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">parse_stream</span></code> is (a special version of) the
<code class="docutils literal notranslate"><span class="pre">parse_stream</span></code> VC-2 pseudocode function provided by the
<a class="reference internal" href="#module-vc2_conformance.bitstream" title="vc2_conformance.bitstream"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream</span></code></a> module. This pseudocode function would
normally decode a VC-2 stream (as per the VC-2 specification), however this
modified version may be used to serialise (or deserialise) a bitstream.  The
modified function takes an extra first argument, a
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a> in this case, which it
will use to produce the serialised bitstream.</p>
<p>The <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a> class takes two
arguments in this example: a
<a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamWriter" title="vc2_conformance.bitstream.io.BitstreamWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamWriter</span></code></a> and the data
structure to serialise (<code class="docutils literal notranslate"><span class="pre">bitstream_description</span></code> in our example).</p>
<p>The <a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamWriter" title="vc2_conformance.bitstream.io.BitstreamWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamWriter</span></code></a> is a wrapper for
file-like objects which provides additional bitwise I/O operations used during
serialisation.</p>
<p>The second argument to <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a>
is the deserialised data structure to be serialised. This may be an ordinary
Python <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dicts</span></code></a> or a <a class="reference internal" href="utility_modules/fixeddict.html#module-vc2_conformance.fixeddict" title="vc2_conformance.fixeddict"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fixeddict</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to serialise (or deserialise) components of a bitstream in
isolation by using other pseudocode functions in place of <code class="docutils literal notranslate"><span class="pre">parse_stream</span></code>.
In this case, the data structure provided to the
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a> must match the
shape expected by the modified pseudocode function used. See
<a class="reference internal" href="#bitstream-fixeddicts"><span class="std std-ref">Deserialised VC-2 bitstream data types</span></a> for an enumeration of the pseudocode functions
available and the expected data structure.</p>
</div>
</div>
<div class="section" id="autofilling-bitstream-values">
<h3>Autofilling bitstream values<a class="headerlink" href="#autofilling-bitstream-values" title="Permalink to this headline">¶</a></h3>
<p>In the example above we explicitly spelt out every field in the bitstream –
including the empty padding field!  If we had omitted this field, the
serialiser will produce an error because it wouldn’t know what padding bits we
wanted it to use in the stream. However, often we don’t care about details such
as these and so the <code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code> can
optionally ‘autofill’ certain values which weren’t given in the deserialised
data structure.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code> class takes an optional
third argument which it uses to autofill missing values. A sensible set of a
autofill values is provided in
<code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.vc2_default_values</span></code> allowing us to rewrite
our example like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">vc2_conformance.bitstream</span> <span class="kn">import</span> <span class="n">vc2_default_values</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">concise_bitstream_description</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">sequences</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="n">Sequence</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">data_units</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>                <span class="n">DataUnit</span><span class="p">(</span>
<span class="gp">... </span>                    <span class="n">parse_info</span><span class="o">=</span><span class="n">ParseInfo</span><span class="p">(</span>
<span class="gp">... </span>                        <span class="n">parse_code</span><span class="o">=</span><span class="n">ParseCodes</span><span class="o">.</span><span class="n">end_of_sequence</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">next_parse_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">previous_parse_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="p">),</span>
<span class="gp">... </span>                <span class="p">),</span>
<span class="gp">... </span>            <span class="p">],</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/path/to/bitstream.vc2&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">Serialiser</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">BitstreamWriter</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">concise_bitstream_description</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">vc2_default_values</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">)</span> <span class="k">as</span> <span class="n">ser</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">parse_stream</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="n">State</span><span class="p">())</span>
</pre></div>
</div>
<p>This time we were able to omit the byte-alignment padding value and parse info
prefix which the serialiser autofilled with zeros and 0x42424344 respectively.</p>
<p>The default values for all fields are given in <a class="reference internal" href="#bitstream-fixeddicts"><span class="std std-ref">Deserialised VC-2 bitstream data types</span></a>.</p>
<p>Unfortunately, when using the mechanism above, autofill values are not provided
for every field in a bitstream (or for fields listed as autofilled with
<code class="docutils literal notranslate"><span class="pre">&lt;AUTO&gt;</span></code> in the documentation). For instance, picture numbers and parse
offset values must still be calculated and specified explicitly. For a more
complete bitstream autofill solution the
<code class="xref py py-func docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.autofill_and_serialise_stream()</span></code> utility
function is provided.</p>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">autofill_and_serialise_stream()</span></code>
function can autofill most values including picture numbers, and parse offset
fields (which marked as <code class="docutils literal notranslate"><span class="pre">&lt;AUTO&gt;</span></code> in the documentation). It also provides a
more concise wrapper around the serialisation process.</p>
<p>Using <code class="xref py py-func docutils literal notranslate"><span class="pre">autofill_and_serialise_stream()</span></code> our
example now becomes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">vc2_conformance.bitstream</span> <span class="kn">import</span> <span class="n">autofill_and_serialise_stream</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">very_concise_bitstream_description</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">sequences</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="n">Sequence</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">data_units</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>                <span class="n">DataUnit</span><span class="p">(</span>
<span class="gp">... </span>                    <span class="n">parse_info</span><span class="o">=</span><span class="n">ParseInfo</span><span class="p">(</span>
<span class="gp">... </span>                        <span class="n">parse_code</span><span class="o">=</span><span class="n">ParseCodes</span><span class="o">.</span><span class="n">end_of_sequence</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="p">),</span>
<span class="gp">... </span>                <span class="p">),</span>
<span class="gp">... </span>            <span class="p">],</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/path/to/bitstream.vc2&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">autofill_and_serialise_stream</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">very_concise_bitstream_description</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that this time we could omit all but the <code class="docutils literal notranslate"><span class="pre">parse_code</span></code> field.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">autofill_and_serialise_stream()</span></code>
function only supports serialisation of entire <a class="reference internal" href="#vc2_conformance.bitstream.Stream" title="vc2_conformance.bitstream.Stream"><code class="xref py py-class docutils literal notranslate"><span class="pre">Streams</span></code></a> and cannot be used to serialise smaller
pieces of a bitstream in isolation.</p>
</div>
</div>
<div class="section" id="deserialising-bitstreams">
<h3>Deserialising bitstreams<a class="headerlink" href="#deserialising-bitstreams" title="Permalink to this headline">¶</a></h3>
<p>To deserialise a bitstream again, the process is similar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">vc2_conformance.bitstream</span> <span class="kn">import</span> <span class="n">BitstreamReader</span><span class="p">,</span> <span class="n">Deserialiser</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/bitstream.vc2&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">Deserialiser</span><span class="p">(</span><span class="n">BitstreamReader</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">as</span> <span class="n">des</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">parse_stream</span><span class="p">(</span><span class="n">des</span><span class="p">,</span> <span class="n">State</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deserialised_bitstream</span> <span class="o">=</span> <span class="n">des</span><span class="o">.</span><span class="n">context</span>
</pre></div>
</div>
<p>This time, we pass a <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Deserialiser" title="vc2_conformance.bitstream.serdes.Deserialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Deserialiser</span></code></a>
(which takes a <a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamReader" title="vc2_conformance.bitstream.io.BitstreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamReader</span></code></a> as
argument) into <code class="docutils literal notranslate"><span class="pre">parse_stream</span></code>. The deserialised bitstream is placed into
<code class="docutils literal notranslate"><span class="pre">des.</span></code><code class="xref py py-attr docutils literal notranslate"><span class="pre">context</span></code> as a hierarchy
of <code class="xref py py-mod docutils literal notranslate"><span class="pre">fixeddicts</span></code>. We can then print or interact with the
deserialised data structure just like any other Python object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># NB: Fixeddicts produce pretty-printed output when printed!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">deserialised_bitstream</span><span class="p">)</span>
<span class="go">Stream:</span>
<span class="go">  sequences:</span>
<span class="go">    0: Sequence:</span>
<span class="go">      data_units:</span>
<span class="go">        0: DataUnit:</span>
<span class="go">          parse_info: ParseInfo:</span>
<span class="go">            padding: 0b</span>
<span class="go">            parse_info_prefix: Correct (0x42424344)</span>
<span class="go">            parse_code: end_of_sequence (0x10)</span>
<span class="go">            next_parse_offset: 0</span>
<span class="go">            previous_parse_offset: 0</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data_unit</span> <span class="o">=</span> <span class="n">deserialised_bitstream</span><span class="p">[</span><span class="s2">&quot;sequences&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;data_units&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data_unit</span><span class="p">[</span><span class="s2">&quot;parse_info&quot;</span><span class="p">][</span><span class="s2">&quot;parse_code&quot;</span><span class="p">])</span>
<span class="go">16</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="deserialised-vc-2-bitstream-data-types">
<span id="bitstream-fixeddicts"></span><h2>Deserialised VC-2 bitstream data types<a class="headerlink" href="#deserialised-vc-2-bitstream-data-types" title="Permalink to this headline">¶</a></h2>
<p>Deserialised VC-2 bitstreams are described by a hierarchy of
<a class="reference internal" href="utility_modules/fixeddict.html#module-vc2_conformance.fixeddict" title="vc2_conformance.fixeddict"><code class="xref py py-class docutils literal notranslate"><span class="pre">fixeddicts</span></code></a>, exported in
<a class="reference internal" href="#module-vc2_conformance.bitstream" title="vc2_conformance.bitstream"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream</span></code></a>.  Each
<a class="reference internal" href="utility_modules/fixeddict.html#module-vc2_conformance.fixeddict" title="vc2_conformance.fixeddict"><code class="xref py py-class docutils literal notranslate"><span class="pre">fixeddict</span></code></a> represents the data read by a particular
VC-2 pseudocode function. Special implementations of these functions are
provided in <a class="reference internal" href="#module-vc2_conformance.bitstream" title="vc2_conformance.bitstream"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream</span></code></a> which may be used to serialise
and deserialise VC-2 bitstreams (or individual parts thereof).</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Pseudocode function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#vc2_conformance.bitstream.Stream" title="vc2_conformance.bitstream.Stream"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">parse_stream</span></code></td>
</tr>
<tr class="row-odd"><td><p>    <a class="reference internal" href="#vc2_conformance.bitstream.Sequence" title="vc2_conformance.bitstream.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">parse_sequence</span></code></td>
</tr>
<tr class="row-even"><td><p>        <a class="reference internal" href="#vc2_conformance.bitstream.DataUnit" title="vc2_conformance.bitstream.DataUnit"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataUnit</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>            <a class="reference internal" href="#vc2_conformance.bitstream.ParseInfo" title="vc2_conformance.bitstream.ParseInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParseInfo</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">parse_info</span></code></td>
</tr>
<tr class="row-even"><td><p>            <a class="reference internal" href="#vc2_conformance.bitstream.SequenceHeader" title="vc2_conformance.bitstream.SequenceHeader"><code class="xref py py-class docutils literal notranslate"><span class="pre">SequenceHeader</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">sequence_header</span></code></td>
</tr>
<tr class="row-odd"><td><p>                <a class="reference internal" href="#vc2_conformance.bitstream.ParseParameters" title="vc2_conformance.bitstream.ParseParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParseParameters</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">parse_parameters</span></code></td>
</tr>
<tr class="row-even"><td><p>                <a class="reference internal" href="#vc2_conformance.bitstream.SourceParameters" title="vc2_conformance.bitstream.SourceParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">SourceParameters</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">source_parameters</span></code></td>
</tr>
<tr class="row-odd"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.FrameSize" title="vc2_conformance.bitstream.FrameSize"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameSize</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">frame_size</span></code></td>
</tr>
<tr class="row-even"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.ColorDiffSamplingFormat" title="vc2_conformance.bitstream.ColorDiffSamplingFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColorDiffSamplingFormat</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">color_diff_sampling_format</span></code></td>
</tr>
<tr class="row-odd"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.ScanFormat" title="vc2_conformance.bitstream.ScanFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScanFormat</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">scan_format</span></code></td>
</tr>
<tr class="row-even"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.FrameRate" title="vc2_conformance.bitstream.FrameRate"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameRate</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">frame_rate</span></code></td>
</tr>
<tr class="row-odd"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.PixelAspectRatio" title="vc2_conformance.bitstream.PixelAspectRatio"><code class="xref py py-class docutils literal notranslate"><span class="pre">PixelAspectRatio</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">pixel_aspect_ratio</span></code></td>
</tr>
<tr class="row-even"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.CleanArea" title="vc2_conformance.bitstream.CleanArea"><code class="xref py py-class docutils literal notranslate"><span class="pre">CleanArea</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">clean_area</span></code></td>
</tr>
<tr class="row-odd"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.SignalRange" title="vc2_conformance.bitstream.SignalRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">SignalRange</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">signal_range</span></code></td>
</tr>
<tr class="row-even"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.ColorSpec" title="vc2_conformance.bitstream.ColorSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColorSpec</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">color_spec</span></code></td>
</tr>
<tr class="row-odd"><td><p>                        <a class="reference internal" href="#vc2_conformance.bitstream.ColorPrimaries" title="vc2_conformance.bitstream.ColorPrimaries"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColorPrimaries</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">color_primaries</span></code></td>
</tr>
<tr class="row-even"><td><p>                        <a class="reference internal" href="#vc2_conformance.bitstream.ColorMatrix" title="vc2_conformance.bitstream.ColorMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColorMatrix</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">color_matrix</span></code></td>
</tr>
<tr class="row-odd"><td><p>                        <a class="reference internal" href="#vc2_conformance.bitstream.TransferFunction" title="vc2_conformance.bitstream.TransferFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransferFunction</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">transfer_function</span></code></td>
</tr>
<tr class="row-even"><td><p>            <a class="reference internal" href="#vc2_conformance.bitstream.PictureParse" title="vc2_conformance.bitstream.PictureParse"><code class="xref py py-class docutils literal notranslate"><span class="pre">PictureParse</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">picture_parse</span></code></td>
</tr>
<tr class="row-odd"><td><p>                <a class="reference internal" href="#vc2_conformance.bitstream.PictureHeader" title="vc2_conformance.bitstream.PictureHeader"><code class="xref py py-class docutils literal notranslate"><span class="pre">PictureHeader</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">picture_header</span></code></td>
</tr>
<tr class="row-even"><td><p>                <a class="reference internal" href="#vc2_conformance.bitstream.WaveletTransform" title="vc2_conformance.bitstream.WaveletTransform"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveletTransform</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">wavelet_transform</span></code></td>
</tr>
<tr class="row-odd"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.TransformParameters" title="vc2_conformance.bitstream.TransformParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransformParameters</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">transform_parameters</span></code></td>
</tr>
<tr class="row-even"><td><p>                        <a class="reference internal" href="#vc2_conformance.bitstream.ExtendedTransformParameters" title="vc2_conformance.bitstream.ExtendedTransformParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtendedTransformParameters</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">extended_transform_parameters</span></code></td>
</tr>
<tr class="row-odd"><td><p>                        <a class="reference internal" href="#vc2_conformance.bitstream.SliceParameters" title="vc2_conformance.bitstream.SliceParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">SliceParameters</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">slice_parameters</span></code></td>
</tr>
<tr class="row-even"><td><p>                        <a class="reference internal" href="#vc2_conformance.bitstream.QuantMatrix" title="vc2_conformance.bitstream.QuantMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantMatrix</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">quant_matrix</span></code></td>
</tr>
<tr class="row-odd"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.TransformData" title="vc2_conformance.bitstream.TransformData"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransformData</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">transform_data</span></code></td>
</tr>
<tr class="row-even"><td><p>                        <a class="reference internal" href="#vc2_conformance.bitstream.LDSlice" title="vc2_conformance.bitstream.LDSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">LDSlice</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">ld_slice</span></code></td>
</tr>
<tr class="row-odd"><td><p>                        <a class="reference internal" href="#vc2_conformance.bitstream.HQSlice" title="vc2_conformance.bitstream.HQSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">HQSlice</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">hq_slice</span></code></td>
</tr>
<tr class="row-even"><td><p>            <a class="reference internal" href="#vc2_conformance.bitstream.FragmentParse" title="vc2_conformance.bitstream.FragmentParse"><code class="xref py py-class docutils literal notranslate"><span class="pre">FragmentParse</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">fragment_parse</span></code></td>
</tr>
<tr class="row-odd"><td><p>                <a class="reference internal" href="#vc2_conformance.bitstream.FragmentHeader" title="vc2_conformance.bitstream.FragmentHeader"><code class="xref py py-class docutils literal notranslate"><span class="pre">FragmentHeader</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">fragment_header</span></code></td>
</tr>
<tr class="row-even"><td><p>                <a class="reference internal" href="#vc2_conformance.bitstream.TransformParameters" title="vc2_conformance.bitstream.TransformParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransformParameters</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">transform_parameters</span></code></td>
</tr>
<tr class="row-odd"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.ExtendedTransformParameters" title="vc2_conformance.bitstream.ExtendedTransformParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtendedTransformParameters</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">extended_transform_parameters</span></code></td>
</tr>
<tr class="row-even"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.SliceParameters" title="vc2_conformance.bitstream.SliceParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">SliceParameters</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">slice_parameters</span></code></td>
</tr>
<tr class="row-odd"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.QuantMatrix" title="vc2_conformance.bitstream.QuantMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantMatrix</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">quant_matrix</span></code></td>
</tr>
<tr class="row-even"><td><p>                <a class="reference internal" href="#vc2_conformance.bitstream.FragmentData" title="vc2_conformance.bitstream.FragmentData"><code class="xref py py-class docutils literal notranslate"><span class="pre">FragmentData</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">fragment_data</span></code></td>
</tr>
<tr class="row-odd"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.LDSlice" title="vc2_conformance.bitstream.LDSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">LDSlice</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">ld_slice</span></code></td>
</tr>
<tr class="row-even"><td><p>                    <a class="reference internal" href="#vc2_conformance.bitstream.HQSlice" title="vc2_conformance.bitstream.HQSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">HQSlice</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">hq_slice</span></code></td>
</tr>
<tr class="row-odd"><td><p>            <a class="reference internal" href="#vc2_conformance.bitstream.AuxiliaryData" title="vc2_conformance.bitstream.AuxiliaryData"><code class="xref py py-class docutils literal notranslate"><span class="pre">AuxiliaryData</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">auxiliary_data</span></code></td>
</tr>
<tr class="row-even"><td><p>            <a class="reference internal" href="#vc2_conformance.bitstream.Padding" title="vc2_conformance.bitstream.Padding"><code class="xref py py-class docutils literal notranslate"><span class="pre">Padding</span></code></a></p></td>
<td><code class="docutils literal notranslate"><span class="pre">padding</span></code></td>
</tr>
</tbody>
</table>
<span><dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.Stream">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">Stream</span></code><a class="headerlink" href="#vc2_conformance.bitstream.Stream" title="Permalink to this definition">¶</a></dt>
<dd><p>(10.3) A VC-2 stream.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>sequences</strong><span class="classifier">[<a class="reference internal" href="#vc2_conformance.bitstream.Sequence" title="vc2_conformance.bitstream.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a>, …]</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.Sequence">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">Sequence</span></code><a class="headerlink" href="#vc2_conformance.bitstream.Sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>(10.4.1) A VC-2 sequence.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>data_units</strong><span class="classifier">[<a class="reference internal" href="#vc2_conformance.bitstream.DataUnit" title="vc2_conformance.bitstream.DataUnit"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataUnit</span></code></a>, …]</span></dt><dd></dd>
<dt><strong>_state</strong><span class="classifier"><a class="reference internal" href="pseudocode.html#vc2_conformance.pseudocode.state.State" title="vc2_conformance.pseudocode.state.State"><code class="xref py py-class docutils literal notranslate"><span class="pre">State</span></code></a></span></dt><dd><p>Computed value. The
<a class="reference internal" href="pseudocode.html#vc2_conformance.pseudocode.state.State" title="vc2_conformance.pseudocode.state.State"><code class="xref py py-class docutils literal notranslate"><span class="pre">State</span></code></a> object being
populated by the parser.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.DataUnit">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">DataUnit</span></code><a class="headerlink" href="#vc2_conformance.bitstream.DataUnit" title="Permalink to this definition">¶</a></dt>
<dd><p>A data unit (e.g. sequence header or picture) and its associated parse
info.  Based on the values read by parse_sequence() (10.4.1) in each
iteration.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>parse_info</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.ParseInfo" title="vc2_conformance.bitstream.ParseInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParseInfo</span></code></a></span></dt><dd></dd>
<dt><strong>sequence_header</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.SequenceHeader" title="vc2_conformance.bitstream.SequenceHeader"><code class="xref py py-class docutils literal notranslate"><span class="pre">SequenceHeader</span></code></a></span></dt><dd></dd>
<dt><strong>picture_parse</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.PictureParse" title="vc2_conformance.bitstream.PictureParse"><code class="xref py py-class docutils literal notranslate"><span class="pre">PictureParse</span></code></a></span></dt><dd></dd>
<dt><strong>fragment_parse</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.FragmentParse" title="vc2_conformance.bitstream.FragmentParse"><code class="xref py py-class docutils literal notranslate"><span class="pre">FragmentParse</span></code></a></span></dt><dd></dd>
<dt><strong>auxiliary_data</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.AuxiliaryData" title="vc2_conformance.bitstream.AuxiliaryData"><code class="xref py py-class docutils literal notranslate"><span class="pre">AuxiliaryData</span></code></a></span></dt><dd></dd>
<dt><strong>padding</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.Padding" title="vc2_conformance.bitstream.Padding"><code class="xref py py-class docutils literal notranslate"><span class="pre">Padding</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.ParseInfo">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">ParseInfo</span></code><a class="headerlink" href="#vc2_conformance.bitstream.ParseInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>(10.5.1) Parse info header defined by <code class="docutils literal notranslate"><span class="pre">parse_info()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>padding</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray</span></code> (autofilled with bitarray())</span></dt><dd><p>Byte alignment padding bits.</p>
</dd>
<dt><strong>parse_info_prefix</strong><span class="classifier">int (autofilled with 1111638852)</span></dt><dd></dd>
<dt><strong>parse_code</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.ParseCodes" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParseCodes</span></code></a> (autofilled with &lt;ParseCodes.end_of_sequence: 16&gt;)</span></dt><dd></dd>
<dt><strong>next_parse_offset</strong><span class="classifier">int (autofilled with &lt;AUTO&gt;)</span></dt><dd></dd>
<dt><strong>previous_parse_offset</strong><span class="classifier">int (autofilled with &lt;AUTO&gt;)</span></dt><dd></dd>
<dt><strong>_offset</strong><span class="classifier">int</span></dt><dd><p>Computed value. The byte offset of the start of this parse_info
block in the bitstream.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.SequenceHeader">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">SequenceHeader</span></code><a class="headerlink" href="#vc2_conformance.bitstream.SequenceHeader" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.1) Sequence header defined by <code class="docutils literal notranslate"><span class="pre">sequence_header()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>parse_parameters</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.ParseParameters" title="vc2_conformance.bitstream.ParseParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParseParameters</span></code></a></span></dt><dd></dd>
<dt><strong>base_video_format</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.BaseVideoFormats" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseVideoFormats</span></code></a> (autofilled with &lt;BaseVideoFormats.custom_format: 0&gt;)</span></dt><dd></dd>
<dt><strong>video_parameters</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.SourceParameters" title="vc2_conformance.bitstream.SourceParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">SourceParameters</span></code></a></span></dt><dd></dd>
<dt><strong>picture_coding_mode</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.PictureCodingModes" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PictureCodingModes</span></code></a> (autofilled with &lt;PictureCodingModes.pictures_are_frames: 0&gt;)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.ParseParameters">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">ParseParameters</span></code><a class="headerlink" href="#vc2_conformance.bitstream.ParseParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.2.1) Sequence header defined by <code class="docutils literal notranslate"><span class="pre">parse_parameters()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>major_version</strong><span class="classifier">int (autofilled with &lt;AUTO&gt;)</span></dt><dd></dd>
<dt><strong>minor_version</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>profile</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.Profiles" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Profiles</span></code></a> (autofilled with &lt;Profiles.high_quality: 3&gt;)</span></dt><dd></dd>
<dt><strong>level</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.Levels" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Levels</span></code></a> (autofilled with &lt;Levels.unconstrained: 0&gt;)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.SourceParameters">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">SourceParameters</span></code><a class="headerlink" href="#vc2_conformance.bitstream.SourceParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.1) Video format overrides defined by <code class="docutils literal notranslate"><span class="pre">source_parameters()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>frame_size</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.FrameSize" title="vc2_conformance.bitstream.FrameSize"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameSize</span></code></a></span></dt><dd></dd>
<dt><strong>color_diff_sampling_format</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.ColorDiffSamplingFormat" title="vc2_conformance.bitstream.ColorDiffSamplingFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColorDiffSamplingFormat</span></code></a></span></dt><dd></dd>
<dt><strong>scan_format</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.ScanFormat" title="vc2_conformance.bitstream.ScanFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScanFormat</span></code></a></span></dt><dd></dd>
<dt><strong>frame_rate</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.FrameRate" title="vc2_conformance.bitstream.FrameRate"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameRate</span></code></a></span></dt><dd></dd>
<dt><strong>pixel_aspect_ratio</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.PixelAspectRatio" title="vc2_conformance.bitstream.PixelAspectRatio"><code class="xref py py-class docutils literal notranslate"><span class="pre">PixelAspectRatio</span></code></a></span></dt><dd></dd>
<dt><strong>clean_area</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.CleanArea" title="vc2_conformance.bitstream.CleanArea"><code class="xref py py-class docutils literal notranslate"><span class="pre">CleanArea</span></code></a></span></dt><dd></dd>
<dt><strong>signal_range</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.SignalRange" title="vc2_conformance.bitstream.SignalRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">SignalRange</span></code></a></span></dt><dd></dd>
<dt><strong>color_spec</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.ColorSpec" title="vc2_conformance.bitstream.ColorSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColorSpec</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.FrameSize">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">FrameSize</span></code><a class="headerlink" href="#vc2_conformance.bitstream.FrameSize" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.3) Frame size override defined by <code class="docutils literal notranslate"><span class="pre">frame_size()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>custom_dimensions_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>frame_width</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
<dt><strong>frame_height</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.ColorDiffSamplingFormat">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">ColorDiffSamplingFormat</span></code><a class="headerlink" href="#vc2_conformance.bitstream.ColorDiffSamplingFormat" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.4) Color-difference sampling override defined by
<code class="docutils literal notranslate"><span class="pre">color_diff_sampling_format()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>custom_color_diff_format_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>color_diff_format_index</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.ColorDifferenceSamplingFormats" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColorDifferenceSamplingFormats</span></code></a> (autofilled with &lt;ColorDifferenceSamplingFormats.color_4_4_4: 0&gt;)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.ScanFormat">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">ScanFormat</span></code><a class="headerlink" href="#vc2_conformance.bitstream.ScanFormat" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.5) Scan format override defined by <code class="docutils literal notranslate"><span class="pre">scan_format()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>custom_scan_format_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>source_sampling</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.SourceSamplingModes" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SourceSamplingModes</span></code></a> (autofilled with &lt;SourceSamplingModes.progressive: 0&gt;)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.FrameRate">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">FrameRate</span></code><a class="headerlink" href="#vc2_conformance.bitstream.FrameRate" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.6) Frame-rate override defined by <code class="docutils literal notranslate"><span class="pre">frame_rate()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>custom_frame_rate_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>index</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.PresetFrameRates" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PresetFrameRates</span></code></a> (autofilled with &lt;PresetFrameRates.fps_25: 3&gt;)</span></dt><dd></dd>
<dt><strong>frame_rate_numer</strong><span class="classifier">int (autofilled with 25)</span></dt><dd></dd>
<dt><strong>frame_rate_denom</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.PixelAspectRatio">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">PixelAspectRatio</span></code><a class="headerlink" href="#vc2_conformance.bitstream.PixelAspectRatio" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.7) Pixel aspect ratio override defined by
<code class="docutils literal notranslate"><span class="pre">pixel_aspect_ratio()</span></code> (errata: also listed as <code class="docutils literal notranslate"><span class="pre">aspect_ratio()</span></code> in
some parts of the spec).</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>custom_pixel_aspect_ratio_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>index</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.PresetPixelAspectRatios" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PresetPixelAspectRatios</span></code></a> (autofilled with &lt;PresetPixelAspectRatios.ratio_1_1: 1&gt;)</span></dt><dd></dd>
<dt><strong>pixel_aspect_ratio_numer</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
<dt><strong>pixel_aspect_ratio_denom</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.CleanArea">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">CleanArea</span></code><a class="headerlink" href="#vc2_conformance.bitstream.CleanArea" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.8) Clean areas override defined by <code class="docutils literal notranslate"><span class="pre">clean_area()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>custom_clean_area_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>clean_width</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
<dt><strong>clean_height</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
<dt><strong>left_offset</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>top_offset</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.SignalRange">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">SignalRange</span></code><a class="headerlink" href="#vc2_conformance.bitstream.SignalRange" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.9) Signal range override defined by <code class="docutils literal notranslate"><span class="pre">signal_range()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>custom_signal_range_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>index</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.PresetSignalRanges" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PresetSignalRanges</span></code></a> (autofilled with &lt;PresetSignalRanges.video_8bit_full_range: 1&gt;)</span></dt><dd></dd>
<dt><strong>luma_offset</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>luma_excursion</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
<dt><strong>color_diff_offset</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>color_diff_excursion</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.ColorSpec">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">ColorSpec</span></code><a class="headerlink" href="#vc2_conformance.bitstream.ColorSpec" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.10.1) Color specification override defined by <code class="docutils literal notranslate"><span class="pre">color_spec()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>custom_color_spec_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>index</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.PresetColorSpecs" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PresetColorSpecs</span></code></a> (autofilled with &lt;PresetColorSpecs.hdtv: 3&gt;)</span></dt><dd></dd>
<dt><strong>color_primaries</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.ColorPrimaries" title="vc2_conformance.bitstream.ColorPrimaries"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColorPrimaries</span></code></a></span></dt><dd></dd>
<dt><strong>color_matrix</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.ColorMatrix" title="vc2_conformance.bitstream.ColorMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColorMatrix</span></code></a></span></dt><dd></dd>
<dt><strong>transfer_function</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.TransferFunction" title="vc2_conformance.bitstream.TransferFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransferFunction</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.ColorPrimaries">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">ColorPrimaries</span></code><a class="headerlink" href="#vc2_conformance.bitstream.ColorPrimaries" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.10.2) Color primaries override defined by <code class="docutils literal notranslate"><span class="pre">color_primaries()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>custom_color_primaries_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>index</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.PresetColorPrimaries" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PresetColorPrimaries</span></code></a> (autofilled with &lt;PresetColorPrimaries.hdtv: 0&gt;)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.ColorMatrix">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">ColorMatrix</span></code><a class="headerlink" href="#vc2_conformance.bitstream.ColorMatrix" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.10.3) Color matrix override defined by <code class="docutils literal notranslate"><span class="pre">color_matrix()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>custom_color_matrix_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>index</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.PresetColorMatrices" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PresetColorMatrices</span></code></a> (autofilled with &lt;PresetColorMatrices.hdtv: 0&gt;)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.TransferFunction">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">TransferFunction</span></code><a class="headerlink" href="#vc2_conformance.bitstream.TransferFunction" title="Permalink to this definition">¶</a></dt>
<dd><p>(11.4.10.4) Transfer function override defined by
<code class="docutils literal notranslate"><span class="pre">transfer_function()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>custom_transfer_function_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>index</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.PresetTransferFunctions" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PresetTransferFunctions</span></code></a> (autofilled with &lt;PresetTransferFunctions.tv_gamma: 0&gt;)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.PictureParse">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">PictureParse</span></code><a class="headerlink" href="#vc2_conformance.bitstream.PictureParse" title="Permalink to this definition">¶</a></dt>
<dd><p>(12.1) A picture data unit defined by <code class="docutils literal notranslate"><span class="pre">picture_parse()</span></code></p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>padding1</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray</span></code> (autofilled with bitarray())</span></dt><dd><p>Picture header byte alignment padding bits.</p>
</dd>
<dt><strong>picture_header</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.PictureHeader" title="vc2_conformance.bitstream.PictureHeader"><code class="xref py py-class docutils literal notranslate"><span class="pre">PictureHeader</span></code></a></span></dt><dd></dd>
<dt><strong>padding2</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray</span></code> (autofilled with bitarray())</span></dt><dd><p>Wavelet transform byte alignment padding bits.</p>
</dd>
<dt><strong>wavelet_transform</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.WaveletTransform" title="vc2_conformance.bitstream.WaveletTransform"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveletTransform</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.PictureHeader">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">PictureHeader</span></code><a class="headerlink" href="#vc2_conformance.bitstream.PictureHeader" title="Permalink to this definition">¶</a></dt>
<dd><p>(12.2) Picture header information defined by <code class="docutils literal notranslate"><span class="pre">picture_header()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>picture_number</strong><span class="classifier">int (autofilled with &lt;AUTO&gt;)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.WaveletTransform">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">WaveletTransform</span></code><a class="headerlink" href="#vc2_conformance.bitstream.WaveletTransform" title="Permalink to this definition">¶</a></dt>
<dd><p>(12.3) Wavelet parameters and coefficients defined by
<code class="docutils literal notranslate"><span class="pre">wavelet_transform()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>transform_parameters</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.TransformParameters" title="vc2_conformance.bitstream.TransformParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransformParameters</span></code></a></span></dt><dd></dd>
<dt><strong>padding</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray</span></code> (autofilled with bitarray())</span></dt><dd><p>Byte alignment padding bits.</p>
</dd>
<dt><strong>transform_data</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.TransformData" title="vc2_conformance.bitstream.TransformData"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransformData</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.TransformParameters">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">TransformParameters</span></code><a class="headerlink" href="#vc2_conformance.bitstream.TransformParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>(12.4.1) Wavelet transform parameters defined by
<code class="docutils literal notranslate"><span class="pre">transform_parameters()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>wavelet_index</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.WaveletFilters" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveletFilters</span></code></a> (autofilled with &lt;WaveletFilters.haar_with_shift: 4&gt;)</span></dt><dd></dd>
<dt><strong>dwt_depth</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>extended_transform_parameters</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.ExtendedTransformParameters" title="vc2_conformance.bitstream.ExtendedTransformParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtendedTransformParameters</span></code></a></span></dt><dd></dd>
<dt><strong>slice_parameters</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.SliceParameters" title="vc2_conformance.bitstream.SliceParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">SliceParameters</span></code></a></span></dt><dd></dd>
<dt><strong>quant_matrix</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.QuantMatrix" title="vc2_conformance.bitstream.QuantMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantMatrix</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.ExtendedTransformParameters">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">ExtendedTransformParameters</span></code><a class="headerlink" href="#vc2_conformance.bitstream.ExtendedTransformParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>(12.4.4.1) Extended (horizontal-only) wavelet transform parameters
defined by <code class="docutils literal notranslate"><span class="pre">extended_transform_parameters()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>asym_transform_index_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>wavelet_index_ho</strong><span class="classifier"><a class="reference external" href="https://bbc.github.io/vc2_data_tables/api.html#vc2_data_tables.WaveletFilters" title="(in SMPTE ST 2042-1 (VC-2) Data Tables v1.0.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveletFilters</span></code></a> (autofilled with &lt;WaveletFilters.haar_with_shift: 4&gt;)</span></dt><dd></dd>
<dt><strong>asym_transform_flag</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>dwt_depth_ho</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.SliceParameters">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">SliceParameters</span></code><a class="headerlink" href="#vc2_conformance.bitstream.SliceParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>(12.4.5.2) Slice dimension parameters defined by
<code class="docutils literal notranslate"><span class="pre">slice_parameters()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>slices_x</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
<dt><strong>slices_y</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
<dt><strong>slice_bytes_numerator</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
<dt><strong>slice_bytes_denominator</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
<dt><strong>slice_prefix_bytes</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>slice_size_scaler</strong><span class="classifier">int (autofilled with 1)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.QuantMatrix">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">QuantMatrix</span></code><a class="headerlink" href="#vc2_conformance.bitstream.QuantMatrix" title="Permalink to this definition">¶</a></dt>
<dd><p>(12.4.5.3) Custom quantisation matrix override defined by
<code class="docutils literal notranslate"><span class="pre">quant_matrix()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>custom_quant_matrix</strong><span class="classifier">bool (autofilled with False)</span></dt><dd></dd>
<dt><strong>quant_matrix</strong><span class="classifier">[int, …] (autofilled with 0)</span></dt><dd><p>Quantization matrix values in bitstream order.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.TransformData">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">TransformData</span></code><a class="headerlink" href="#vc2_conformance.bitstream.TransformData" title="Permalink to this definition">¶</a></dt>
<dd><p>(13.5.2) Transform coefficient data slices read by
<code class="docutils literal notranslate"><span class="pre">transform_data()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>ld_slices</strong><span class="classifier">[<a class="reference internal" href="#vc2_conformance.bitstream.LDSlice" title="vc2_conformance.bitstream.LDSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">LDSlice</span></code></a>, …]</span></dt><dd></dd>
<dt><strong>hq_slices</strong><span class="classifier">[<a class="reference internal" href="#vc2_conformance.bitstream.HQSlice" title="vc2_conformance.bitstream.HQSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">HQSlice</span></code></a>, …]</span></dt><dd></dd>
<dt><strong>_state</strong><span class="classifier"><a class="reference internal" href="pseudocode.html#vc2_conformance.pseudocode.state.State" title="vc2_conformance.pseudocode.state.State"><code class="xref py py-class docutils literal notranslate"><span class="pre">State</span></code></a></span></dt><dd><p>Computed value. A copy of the
<a class="reference internal" href="pseudocode.html#vc2_conformance.pseudocode.state.State" title="vc2_conformance.pseudocode.state.State"><code class="xref py py-class docutils literal notranslate"><span class="pre">State</span></code></a> dictionary held
when processing this transform data. May be used to work out how
the deserialised values correspond to transform components within
the slices above.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.LDSlice">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">LDSlice</span></code><a class="headerlink" href="#vc2_conformance.bitstream.LDSlice" title="Permalink to this definition">¶</a></dt>
<dd><p>(13.5.3.1) The data associated with a single low-delay slice, defined
by <code class="docutils literal notranslate"><span class="pre">ld_slice()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>qindex</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>slice_y_length</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>y_transform</strong><span class="classifier">[int, …] (autofilled with 0)</span></dt><dd><p>Slice luma transform coefficients in bitstream order.</p>
</dd>
<dt><strong>c_transform</strong><span class="classifier">[int, …] (autofilled with 0)</span></dt><dd><p>Slice interleaved colordifference transform coefficients in
bitstream order.</p>
</dd>
<dt><strong>y_block_padding</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray</span></code> (autofilled with bitarray())</span></dt><dd><p>Unused bits from y_transform bounded block.</p>
</dd>
<dt><strong>c_block_padding</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray</span></code> (autofilled with bitarray())</span></dt><dd><p>Unused bits from c_transform bounded block.</p>
</dd>
<dt><strong>_sx</strong><span class="classifier">int</span></dt><dd><p>Computed value. Slice coordinates.</p>
</dd>
<dt><strong>_sy</strong><span class="classifier">int</span></dt><dd><p>Computed value. Slice coordinates.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.HQSlice">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">HQSlice</span></code><a class="headerlink" href="#vc2_conformance.bitstream.HQSlice" title="Permalink to this definition">¶</a></dt>
<dd><p>(13.5.4) The data associated with a single high-quality slice, defined
by <code class="docutils literal notranslate"><span class="pre">hq_slice()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>prefix_bytes</strong><span class="classifier">bytes (autofilled with b’’)</span></dt><dd></dd>
<dt><strong>qindex</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>slice_y_length</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>slice_c1_length</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>slice_c2_length</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>y_transform</strong><span class="classifier">[int, …] (autofilled with 0)</span></dt><dd><p>Slice luma transform coefficients in bitstream order.</p>
</dd>
<dt><strong>c1_transform</strong><span class="classifier">[int, …] (autofilled with 0)</span></dt><dd><p>Slice color difference 1 transform coefficients in bitstream order.</p>
</dd>
<dt><strong>c2_transform</strong><span class="classifier">[int, …] (autofilled with 0)</span></dt><dd><p>Slice color difference 2 transform coefficients in bitstream order.</p>
</dd>
<dt><strong>y_block_padding</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray</span></code> (autofilled with bitarray())</span></dt><dd><p>Unused bits in y_transform bounded block</p>
</dd>
<dt><strong>c1_block_padding</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray</span></code> (autofilled with bitarray())</span></dt><dd><p>Unused bits in c1_transform bounded block</p>
</dd>
<dt><strong>c2_block_padding</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray</span></code> (autofilled with bitarray())</span></dt><dd><p>Unused bits in c2_transform bounded block</p>
</dd>
<dt><strong>_sx</strong><span class="classifier">int</span></dt><dd><p>Computed value. Slice coordinates.</p>
</dd>
<dt><strong>_sy</strong><span class="classifier">int</span></dt><dd><p>Computed value. Slice coordinates.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.FragmentParse">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">FragmentParse</span></code><a class="headerlink" href="#vc2_conformance.bitstream.FragmentParse" title="Permalink to this definition">¶</a></dt>
<dd><p>(14.1) A fragment data unit defined by <code class="docutils literal notranslate"><span class="pre">fragment_parse()</span></code> containing
part of a picture.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>fragment_header</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.FragmentHeader" title="vc2_conformance.bitstream.FragmentHeader"><code class="xref py py-class docutils literal notranslate"><span class="pre">FragmentHeader</span></code></a></span></dt><dd></dd>
<dt><strong>transform_parameters</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.TransformParameters" title="vc2_conformance.bitstream.TransformParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransformParameters</span></code></a></span></dt><dd></dd>
<dt><strong>fragment_data</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.FragmentData" title="vc2_conformance.bitstream.FragmentData"><code class="xref py py-class docutils literal notranslate"><span class="pre">FragmentData</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.FragmentHeader">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">FragmentHeader</span></code><a class="headerlink" href="#vc2_conformance.bitstream.FragmentHeader" title="Permalink to this definition">¶</a></dt>
<dd><p>(14.2) Fragment header defined by <code class="docutils literal notranslate"><span class="pre">fragment_header()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>picture_number</strong><span class="classifier">int (autofilled with &lt;AUTO&gt;)</span></dt><dd></dd>
<dt><strong>fragment_data_length</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>fragment_slice_count</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>fragment_x_offset</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
<dt><strong>fragment_y_offset</strong><span class="classifier">int (autofilled with 0)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.FragmentData">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">FragmentData</span></code><a class="headerlink" href="#vc2_conformance.bitstream.FragmentData" title="Permalink to this definition">¶</a></dt>
<dd><p>(14.4) Transform coefficient data slices read by <code class="docutils literal notranslate"><span class="pre">fragment_data()</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl>
<dt><strong>ld_slices</strong><span class="classifier">[<a class="reference internal" href="#vc2_conformance.bitstream.LDSlice" title="vc2_conformance.bitstream.LDSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">LDSlice</span></code></a>, …]</span></dt><dd></dd>
<dt><strong>hq_slices</strong><span class="classifier">[<a class="reference internal" href="#vc2_conformance.bitstream.HQSlice" title="vc2_conformance.bitstream.HQSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">HQSlice</span></code></a>, …]</span></dt><dd></dd>
<dt><strong>_state</strong><span class="classifier"><a class="reference internal" href="pseudocode.html#vc2_conformance.pseudocode.state.State" title="vc2_conformance.pseudocode.state.State"><code class="xref py py-class docutils literal notranslate"><span class="pre">State</span></code></a></span></dt><dd><p>Computed value. A copy of the
<a class="reference internal" href="pseudocode.html#vc2_conformance.pseudocode.state.State" title="vc2_conformance.pseudocode.state.State"><code class="xref py py-class docutils literal notranslate"><span class="pre">State</span></code></a> dictionary held
when processing this fragment data. May be used to work out how the
deserialised values correspond to transform components within the
slices above.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.AuxiliaryData">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">AuxiliaryData</span></code><a class="headerlink" href="#vc2_conformance.bitstream.AuxiliaryData" title="Permalink to this definition">¶</a></dt>
<dd><p>(10.4.4) Auxiliary data block (as per auxiliary_data()).</p>
<dl class="field-list simple">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>bytes</strong><span class="classifier">bytes (autofilled with b’’)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py bitstreamfixeddict">
<dt id="vc2_conformance.bitstream.Padding">
<em class="property"><span class="pre">fixeddict</span> </em><code class="sig-name descname"><span class="pre">Padding</span></code><a class="headerlink" href="#vc2_conformance.bitstream.Padding" title="Permalink to this definition">¶</a></dt>
<dd><p>(10.4.5) Padding data block (as per padding()).</p>
<dl class="field-list simple">
<dt class="field-odd">Keys</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>bytes</strong><span class="classifier">bytes (autofilled with b’’)</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

</span></div>
<div class="section" id="module-vc2_conformance.bitstream.serdes">
<span id="serdes-a-serialiser-deserialiser-framework"></span><h2><a class="reference internal" href="#module-vc2_conformance.bitstream.serdes" title="vc2_conformance.bitstream.serdes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">serdes</span></code></a>: A serialiser/deserialiser framework<a class="headerlink" href="#module-vc2_conformance.bitstream.serdes" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#module-vc2_conformance.bitstream.serdes" title="vc2_conformance.bitstream.serdes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.serdes</span></code></a> module provides a framework for
transforming a set of functions designed to process a bitstream (e.g. the VC-2
specification’s pseudocode) into general-purpose bitstream serialisers,
deserialisers and analysers.</p>
<p>The following sections introduce the design and operation of this module in
detail.</p>
<div class="section" id="a-basic-bitstream-serialiser">
<h3>A basic bitstream serialiser<a class="headerlink" href="#a-basic-bitstream-serialiser" title="Permalink to this headline">¶</a></h3>
<p>The VC-2 specification describes the bitstream and decoding process in a series
of pseudocode functions such as the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">frame_size</span><span class="p">(</span><span class="n">video_parameters</span><span class="p">):</span>
    <span class="n">custom_dimensions_flag</span> <span class="o">=</span> <span class="n">read_bool</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="n">custom_dimensions_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">video_parameters</span><span class="p">[</span><span class="n">frame_width</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_uint</span><span class="p">()</span>
        <span class="n">video_parameters</span><span class="p">[</span><span class="n">frame_height</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_uint</span><span class="p">()</span>
</pre></div>
</div>
<p>To see how this definition might be transformed into a general purpose
bitstream serialiser we must transform this definition of a program which
<em>reads</em> a VC-2 bitstream into one which <em>writes</em> one.</p>
<p>We start by replacing all of the <code class="docutils literal notranslate"><span class="pre">read_*</span></code> functions with equivalent
<code class="docutils literal notranslate"><span class="pre">write_*</span></code> functions (which we define here as returning the value that they
write):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>frame_size(video_parameters):
    custom_dimensions_flag = write_bool(???)
    if(custom_dimensions_flag == True)
        video_parameters[frame_width] = write_uint(???)
        video_parameters[frame_height] = write_uint(???)
</pre></div>
</div>
<p>Next we need to define what values we’d like writing by replacing the <code class="docutils literal notranslate"><span class="pre">???</span></code>
placeholders with a suitable global variables like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_custom_dimensions_flag</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">new_frame_width</span> <span class="o">=</span> <span class="mi">1920</span>
<span class="n">new_frame_height</span> <span class="o">=</span> <span class="mi">1080</span>

<span class="n">frame_size</span><span class="p">(</span><span class="n">video_parameters</span><span class="p">):</span>
    <span class="n">custom_dimensions_flag</span> <span class="o">=</span> <span class="n">write_bool</span><span class="p">(</span><span class="n">new_custom_dimensions_flag</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">custom_dimensions_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">video_parameters</span><span class="p">[</span><span class="n">frame_width</span><span class="p">]</span> <span class="o">=</span> <span class="n">write_uint</span><span class="p">(</span><span class="n">new_frame_width</span><span class="p">)</span>
        <span class="n">video_parameters</span><span class="p">[</span><span class="n">frame_height</span><span class="p">]</span> <span class="o">=</span> <span class="n">write_uint</span><span class="p">(</span><span class="n">new_frame_height</span><span class="p">)</span>
</pre></div>
</div>
<p>We have now transformed the VC-2 pseudocode bitstream <em>reader</em> function into a
<em>writer</em> function. What’s more, by just changing the values of global variables
we created it is possible to use this function as a general-purpose bitstream
serialiser.</p>
</div>
<div class="section" id="a-basic-deserialiser">
<h3>A basic deserialiser<a class="headerlink" href="#a-basic-deserialiser" title="Permalink to this headline">¶</a></h3>
<p>Unfortunately, the original bitstream reader pseudocode from the VC-2
specification is not quite usable as a general-purpose bitstream deserialiser:</p>
<ul class="simple">
<li><p>The reader does not capture every value read from the bitstream in a variable
we can later examine (e.g. the <code class="docutils literal notranslate"><span class="pre">custom_dimensions_flag</span></code> is kept in a local
variable and not returned).</p></li>
<li><p>The values which are captured are stored in a structure designed to aid
decoding and not necessarily to faithfully describe a bitstream.</p></li>
</ul>
<p>Lets create a new version of the reader function which overcomes these
limitations. We redefine the <code class="docutils literal notranslate"><span class="pre">read_*</span></code> functions to take an additional
argument naming a global variable where the read values will be stored, in
addition to being returned, giving the following pseudocode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">read_custom_dimensions_flag</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">read_frame_width</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">read_frame_height</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">frame_size</span><span class="p">(</span><span class="n">video_parameters</span><span class="p">):</span>
    <span class="n">custom_dimensions_flag</span> <span class="o">=</span> <span class="n">read_bool</span><span class="p">(</span><span class="n">read_custom_dimensions_flag</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">custom_dimensions_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">video_parameters</span><span class="p">[</span><span class="n">frame_width</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_uint</span><span class="p">(</span><span class="n">read_frame_width</span><span class="p">)</span>
        <span class="n">video_parameters</span><span class="p">[</span><span class="n">frame_height</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_uint</span><span class="p">(</span><span class="n">read_frame_height</span><span class="p">)</span>
</pre></div>
</div>
<p>This small change ensures that every value read from the bitstream is captured
in a global variable which we can later examine and which is orthogonal to
whatever data structures the VC-2 pseudocode might otherwise use.</p>
<div class="section" id="an-introduction-to-the-serdes-interface">
<h4>An introduction to the <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> interface<a class="headerlink" href="#an-introduction-to-the-serdes-interface" title="Permalink to this headline">¶</a></h4>
<p>The similarities between the transformations required to turn the VC-2
pseudocode into general purpose serialisers and deserialisers should be fairly
clear. In fact, the only difference between the two is that in one the
functions are called <code class="docutils literal notranslate"><span class="pre">read_*</span></code> and in the other they’re called <code class="docutils literal notranslate"><span class="pre">write_*</span></code>. In
both cases, the <code class="docutils literal notranslate"><span class="pre">read_*</span></code> and <code class="docutils literal notranslate"><span class="pre">write_*</span></code> functions take essentially the same
arguments: a name of a global variable.</p>
<p>This module defines the <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> interface which can be used by the
VC-2 pseudocode specifications to drive both bitstream serialisation and
deserialisation. To use it, we replace the <code class="docutils literal notranslate"><span class="pre">read_*</span></code> or <code class="docutils literal notranslate"><span class="pre">write_*</span></code> calls
with <code class="docutils literal notranslate"><span class="pre">serdes.*</span></code> calls.</p>
<p>Translating the <code class="docutils literal notranslate"><span class="pre">frame_size</span></code> function into valid Python and taking a
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> instance as an argument we arrive at the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">frame_size</span><span class="p">(</span><span class="n">serdes</span><span class="p">,</span> <span class="n">video_parameters</span><span class="p">):</span>
    <span class="n">custom_dimensions_flag</span> <span class="o">=</span> <span class="n">serdes</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span><span class="s2">&quot;custom_dimensions_flag&quot;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">custom_dimensions_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">video_parameters</span><span class="p">[</span><span class="s2">&quot;frame_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serdes</span><span class="o">.</span><span class="n">uint</span><span class="p">(</span><span class="s2">&quot;frame_width&quot;</span><span class="p">)</span>
        <span class="n">video_parameters</span><span class="p">[</span><span class="s2">&quot;frame_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serdes</span><span class="o">.</span><span class="n">uint</span><span class="p">(</span><span class="s2">&quot;frame_height&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To deserialise (read) a bitstream we use the <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Deserialiser" title="vc2_conformance.bitstream.serdes.Deserialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Deserialiser</span></code></a>
implementation of <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">vc2_conformance.bitstream</span> <span class="kn">import</span> <span class="n">BitstreamReader</span><span class="p">,</span> <span class="n">Deserialiser</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">BitstreamReader</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;frame_size_snippet.bin&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Deserialiser</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span> <span class="k">as</span> <span class="n">des</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">frame_size</span><span class="p">(</span><span class="n">des</span><span class="p">,</span> <span class="p">{})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">des</span><span class="o">.</span><span class="n">context</span>
<span class="go">{&quot;custom_dimensions_flag&quot;: True, &quot;frame_width&quot;: 1920, &quot;frame_height&quot;: 1080}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.context" title="vc2_conformance.bitstream.serdes.SerDes.context"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SerDes.context</span></code></a> property is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> which contains
each of the values read from the bitstream (named as per the calls to the
various <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> methods).</p>
<p>In the nomenclature of this module, this <em>context</em> dictionary holds values for
each of the <em>target names</em> specified by <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.bool" title="vc2_conformance.bitstream.serdes.SerDes.bool"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SerDes.bool()</span></code></a>,
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.uint" title="vc2_conformance.bitstream.serdes.SerDes.uint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SerDes.uint()</span></code></a> etc.</p>
<p>Values to be serialised should be structured into a context dictionary of
similar shape and passed to a <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">vc2_conformance.bitstream</span> <span class="kn">import</span> <span class="n">BitstreamWriter</span><span class="p">,</span> <span class="n">Serialiser</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span> <span class="o">=</span> <span class="n">BitstreamWriter</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;frame_size_snippet.bin&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;custom_dimensions_flag&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;frame_width&quot;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span> <span class="s2">&quot;frame_height&quot;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Serialiser</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="k">as</span> <span class="n">ser</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">frame_size</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<p>In this example a bitstream containing a ‘1’ followed by the variable-length
integers ‘1920’ and ‘1080’ would be written to the bitstream.</p>
</div>
</div>
<div class="section" id="verification">
<h3>Verification<a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> implementations perform various ‘sanity checks’ during
serialisation and deserialisation to ensure that the values passed in or
returned have a 1:1 correspondence with values in the bitstream.</p>
<ul class="simple">
<li><p>When values are read during deserialisation, <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Deserialiser" title="vc2_conformance.bitstream.serdes.Deserialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Deserialiser</span></code></a> checks
that names are not re-used, guaranteeing that if a value appears in the
bitstream it also appears in the output context dictionary (and are not
later overwritten).</p></li>
<li><p>When values are written during serialisation, <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a> checks
that every value in the context dictionary is used exactly once, ensuring
that every value provided is represented in the bitstream.</p></li>
<li><p>During serialisation, values are also checked to ensure they can be
correctly represented by the bitstream encoding. For example, providing a
negative value to <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.uint" title="vc2_conformance.bitstream.serdes.SerDes.uint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">uint()</span></code></a> will fail.</p></li>
</ul>
</div>
<div class="section" id="representing-hierarchy">
<h3>Representing hierarchy<a class="headerlink" href="#representing-hierarchy" title="Permalink to this headline">¶</a></h3>
<p>The VC-2 bitstream does not represent a flat collection of values but rather a
hierarchy. The <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> interface provides additional facilities to
allow this structure to be recreated in the deserialised representation, making
it easier to inspect and describes bitstreams in their deserialised form.</p>
<p>For example, in the VC-2 specification, the <code class="docutils literal notranslate"><span class="pre">source_parameters</span></code> function
(11.4) is defined by a series of functions which each read the values
relating to a particular video feature such as the <code class="docutils literal notranslate"><span class="pre">frame_size</span></code> function
we’ve seen above. To collect together related values we can use
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.subcontext" title="vc2_conformance.bitstream.serdes.SerDes.subcontext"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SerDes.subcontext()</span></code></a> to create nested context dictionaries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">source_parameters</span><span class="p">(</span><span class="n">serdes</span><span class="p">):</span>
    <span class="n">video_parameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">serdes</span><span class="o">.</span><span class="n">subcontext</span><span class="p">(</span><span class="s2">&quot;frame_size&quot;</span><span class="p">):</span>
        <span class="n">frame_size</span><span class="p">(</span><span class="n">serdes</span><span class="p">,</span> <span class="n">video_parameters</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">serdes</span><span class="o">.</span><span class="n">subcontext</span><span class="p">(</span><span class="s2">&quot;color_diff_sampling_format&quot;</span><span class="p">):</span>
        <span class="n">color_diff_sampling_format</span><span class="p">(</span><span class="n">serdes</span><span class="p">,</span> <span class="n">video_parameters</span><span class="p">)</span>
    <span class="c1"># ...</span>
    <span class="k">return</span> <span class="n">video_parameters</span>
</pre></div>
</div>
<p>This results in a nested dictionary structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Deserialiser</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span> <span class="k">as</span> <span class="n">des</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">video_parameters</span> <span class="o">=</span> <span class="n">source_parameters</span><span class="p">(</span><span class="n">des</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">des</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
<span class="go">{</span>
<span class="go">    &quot;frame_size&quot;: {</span>
<span class="go">        &quot;custom_dimensions_flag&quot;: True,</span>
<span class="go">        &quot;frame_width&quot;: 1920,</span>
<span class="go">        &quot;frame_height&quot;: 1080,</span>
<span class="go">    },</span>
<span class="go">    &quot;color_diff_sampling_format&quot;: {</span>
<span class="go">        &quot;custom_color_diff_format_flag&quot;: False,</span>
<span class="go">    },</span>
<span class="go">    # ...</span>
<span class="go">}</span>
</pre></div>
</div>
<p>When used with <a class="reference internal" href="utility_modules/fixeddict.html#module-vc2_conformance.fixeddict" title="vc2_conformance.fixeddict"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.fixeddict</span></code></a>, <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> also
makes it possible to define custom dictionary types for each part of the
hierarchy using the <a class="reference internal" href="#vc2_conformance.bitstream.serdes.context_type" title="vc2_conformance.bitstream.serdes.context_type"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_type()</span></code></a> decorator. Benefits include:</p>
<ul class="simple">
<li><p>Improved ‘pretty-printed’ string representations.</p></li>
<li><p>Additional checks that unexpected values are not used accidentally in the bitstream.</p></li>
</ul>
<p>For example, here’s how the <code class="docutils literal notranslate"><span class="pre">parse_info</span></code> header (10.5.1) might be represented:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">vc2_conformance.fixeddict</span> <span class="kn">import</span> <span class="n">fixeddict</span><span class="p">,</span> <span class="n">Entry</span>
<span class="kn">from</span> <span class="nn">vc2_conformance.formatters</span> <span class="kn">import</span> <span class="n">Hex</span>
<span class="kn">from</span> <span class="nn">vc2_data_tables</span> <span class="kn">import</span> <span class="n">ParseCodes</span><span class="p">,</span> <span class="n">PARSE_INFO_PREFIX</span>
<span class="n">ParseInfo</span> <span class="o">=</span> <span class="n">fixeddict</span><span class="p">(</span>
    <span class="s2">&quot;ParseInfo&quot;</span><span class="p">,</span>
    <span class="n">Entry</span><span class="p">(</span><span class="s2">&quot;parse_info_prefix&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="n">Hex</span><span class="p">(</span><span class="mi">8</span><span class="p">)),</span>
    <span class="n">Entry</span><span class="p">(</span><span class="s2">&quot;parse_code&quot;</span><span class="p">,</span> <span class="n">enum</span><span class="o">=</span><span class="n">ParseCodes</span><span class="p">),</span>
    <span class="n">Entry</span><span class="p">(</span><span class="s2">&quot;next_parse_offset&quot;</span><span class="p">),</span>
    <span class="n">Entry</span><span class="p">(</span><span class="s2">&quot;previous_parse_offset&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="nd">@context_type</span><span class="p">(</span><span class="n">ParseInfo</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">parse_info</span><span class="p">(</span><span class="n">serdes</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
    <span class="n">serdes</span><span class="o">.</span><span class="n">nbits</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;parse_info_prefix&quot;</span><span class="p">)</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;parse_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serdes</span><span class="o">.</span><span class="n">nbits</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;parse_code&quot;</span><span class="p">)</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;next_parse_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serdes</span><span class="o">.</span><span class="n">nbits</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="s2">&quot;next_parse_offset&quot;</span><span class="p">)</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;previous_parse_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serdes</span><span class="o">.</span><span class="n">nbits</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="s2">&quot;previous_parse_offset&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the above we can quickly create structures ready for serialisation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">ParseInfo</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">parse_info_prefix</span><span class="o">=</span><span class="n">PARSE_INFO_PREFIX</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">parse_code</span><span class="o">=</span><span class="n">ParseCodes</span><span class="o">.</span><span class="n">end_of_sequence</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">next_parse_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">previous_parse_offset</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Deserialiser</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="k">as</span> <span class="n">des</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">parse_info</span><span class="p">(</span><span class="n">des</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<p>We also benefit from improved string formatting when deserialising values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Deserialiser</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span> <span class="k">as</span> <span class="n">des</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">parse_info</span><span class="p">(</span><span class="n">des</span><span class="p">,</span> <span class="p">{})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">des</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
<span class="go">ParseInfo:</span>
<span class="go">  parse_info_prefix: 0x42424344</span>
<span class="go">  parse_code: end_of_sequence (0x10)</span>
<span class="go">  next_parse_offset: 0</span>
<span class="go">  previous_parse_offset: 1234</span>
</pre></div>
</div>
</div>
<div class="section" id="representing-arrays">
<h3>Representing arrays<a class="headerlink" href="#representing-arrays" title="Permalink to this headline">¶</a></h3>
<p>The VC-2 bitstream format includes a number of array-like fields, for example
arrays of transform coefficients within slices. Rather than defining unique
names for every array value, <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> allows values to be declared as
lists. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">list_example</span><span class="p">(</span><span class="n">serdes</span><span class="p">):</span>
    <span class="n">serdes</span><span class="o">.</span><span class="n">declare_list</span><span class="p">(</span><span class="s2">&quot;three_values&quot;</span><span class="p">)</span>
    <span class="n">serdes</span><span class="o">.</span><span class="n">uint</span><span class="p">(</span><span class="s2">&quot;three_values&quot;</span><span class="p">)</span>
    <span class="n">serdes</span><span class="o">.</span><span class="n">uint</span><span class="p">(</span><span class="s2">&quot;three_values&quot;</span><span class="p">)</span>
    <span class="n">serdes</span><span class="o">.</span><span class="n">uint</span><span class="p">(</span><span class="s2">&quot;three_values&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>When deserialising, the result will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Deserialiser</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span> <span class="k">as</span> <span class="n">des</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">list_example</span><span class="p">(</span><span class="n">des</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">des</span><span class="o">.</span><span class="n">context</span>
<span class="go">{&quot;three_values&quot;: [100, 200, 300]}</span>
</pre></div>
</div>
<p>Likewise, when serialising, a list of values (of the correct length) should
also be provided:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;three_values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Deserialiser</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="k">as</span> <span class="n">des</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">list_example</span><span class="p">(</span><span class="n">des</span><span class="p">)</span>
</pre></div>
</div>
<p>As usual, the <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> classes will verify that the correct number of
values is present and will throw exceptions when too many or too few are
provided.</p>
</div>
<div class="section" id="computed-values">
<h3>Computed values<a class="headerlink" href="#computed-values" title="Permalink to this headline">¶</a></h3>
<p>In some circumstances, when interpreting a deserialised bitstream it may be
necessary to know information computed by an earlier part of the bitstream. For
example, the dimensions of a slice depend on numerous video formatting options.
To avoid error-prone reimplementation of these calculations it is possible to
use <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.computed_value" title="vc2_conformance.bitstream.serdes.SerDes.computed_value"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SerDes.computed_value()</span></code></a> to add values to the context dictionary
which do not appear in the bitstream. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ld_slice</span><span class="p">(</span><span class="n">serdes</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">):</span>
    <span class="n">serdes</span><span class="o">.</span><span class="n">computed_value</span><span class="p">(</span><span class="s2">&quot;_slices_x&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;slices_x&quot;</span><span class="p">])</span>
    <span class="n">serdes</span><span class="o">.</span><span class="n">computed_value</span><span class="p">(</span><span class="s2">&quot;_slices_y&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;slices_y&quot;</span><span class="p">])</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>The computed value will be set in the context dictionary regardless of whether
serialisation or deserialisation is taking place and any existing value is
always ignored.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended that by convention computed value target names are
prefixed or suffixed with an underscore.</p>
</div>
</div>
<div class="section" id="default-values-during-serialisation">
<h3>Default values during serialisation<a class="headerlink" href="#default-values-during-serialisation" title="Permalink to this headline">¶</a></h3>
<p>As discussed above, the default behaviour of the <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a> is to
require that every value in the bitstream is provided in the context dictionary
to make it explicit what is being serialised. In certain cases, however, it
may be desirable for certain values to be filled in automatically. For
example:</p>
<ul class="simple">
<li><p>For pre-filling constants like the parse_info prefix.</p></li>
<li><p>For use in unit tests where only certain bitstream fields’ values are of
importance (and assigning defaults for the remainder makes the code clearer).</p></li>
<li><p>For providing default (e.g. zero) values for padding fields</p></li>
</ul>
<p>To facilitate this, the <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a> class may be passed a default
value lookup like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">default_values</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="n">ParseInfo</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;parse_info_prefix&quot;</span><span class="p">:</span> <span class="n">PARSE_INFO_PREFIX</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;parse_code&quot;</span><span class="p">:</span> <span class="n">ParseCodes</span><span class="o">.</span><span class="n">end_of_sequence</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;next_parse_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;previous_parse_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span> <span class="o">=</span> <span class="n">BitstreamWriter</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;frame_size_snippet.bin&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">ParseInfo</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">parse_code</span><span class="o">=</span><span class="n">ParseCodes</span><span class="o">.</span><span class="n">end_of_sequence</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">previous_parse_offset</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Serialiser</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">default_values</span><span class="o">=</span><span class="n">default_values</span><span class="p">)</span> <span class="k">as</span> <span class="n">ser</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">parse_info</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">default_values</span></code> lookup should provide a separate set of default values
for each context dictionary type. See
<code class="xref py py-data docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.vc2_fixeddicts.fixeddict_default_values</span></code>
for a complete example.</p>
<p>For arrays/lists of values, the default value provided will be usd to populate
array elements and not to provide a default for the list as a whole.</p>
<p>Where a default value is not found in the lookup, a :py;exc:<cite>KeyError</cite> will be
thrown as usual. This behaviour allows a partial set of default values to be
provided (e.g. providing defaults only for padding values) while still
validating that the provided input is correct.</p>
<div class="section" id="api">
<h4>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h4>
<dl class="py class">
<dt id="vc2_conformance.bitstream.serdes.SerDes">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">SerDes</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">io</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes" title="Permalink to this definition">¶</a></dt>
<dd><p>The base serialiser/deserialiser interface and implementation.</p>
<p>This base implementation includes all but the value writing/reading
features of the serialisation and deserialisation process.</p>
<dl class="field-list">
<dt class="field-odd">Attributes</dt>
<dd class="field-odd"><dl>
<dt><strong>io</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamReader" title="vc2_conformance.bitstream.io.BitstreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamReader</span></code></a> or <a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamWriter" title="vc2_conformance.bitstream.io.BitstreamWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamWriter</span></code></a></span></dt><dd><p>The I/O interface in use.</p>
</dd>
<dt><a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.context" title="vc2_conformance.bitstream.serdes.SerDes.context"><code class="xref py py-obj docutils literal notranslate"><span class="pre">context</span></code></a><span class="classifier">dict or None</span></dt><dd><p>Get the top-level context dictionary.</p>
</dd>
<dt><strong>cur_context</strong><span class="classifier">dict or None</span></dt><dd><p>The context dictionary currently being populated.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.bool">
<code class="sig-name descname"><span class="pre">bool</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.bool" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads or writes a boolean (single bit) in a bitstream (as per (A.3.2)
read_bool()).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target for the bit (as a <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.bool" title="vc2_conformance.bitstream.serdes.SerDes.bool"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>).</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>value</strong><span class="classifier">bool</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.nbits">
<code class="sig-name descname"><span class="pre">nbits</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_bits</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.nbits" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads or writes a fixed-length unsigned integer in a bitstream (as
per (A.3.3) read_nbits()).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target for the value (as an <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>).</p>
</dd>
<dt><strong>num_bits</strong><span class="classifier">int</span></dt><dd><p>The number of bits in the value.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>value</strong><span class="classifier">int</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.uint_lit">
<code class="sig-name descname"><span class="pre">uint_lit</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_bytes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.uint_lit" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads or writes a fixed-length unsigned integer in a bitstream (as
per (A.3.4) read_uint_lit()). Not to be confused with <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.uint" title="vc2_conformance.bitstream.serdes.SerDes.uint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">uint()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target for the value (as an <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>).</p>
</dd>
<dt><strong>num_bytes</strong><span class="classifier">int</span></dt><dd><p>The number of bytes in the value.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>value</strong><span class="classifier">int</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.bitarray">
<code class="sig-name descname"><span class="pre">bitarray</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_bits</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.bitarray" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads or writes a fixed-length string of bits from the bitstream as a
<code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray.bitarray</span></code>. This may be a more sensible type for
holding unpredictably sized non-integer binary values such as padding
bits.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target for the value (as a <code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray.bitarray</span></code>).</p>
</dd>
<dt><strong>num_bits</strong><span class="classifier">int</span></dt><dd><p>The number of bits in the value.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl>
<dt><strong>value</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray.bitarray</span></code></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.bytes">
<code class="sig-name descname"><span class="pre">bytes</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_bytes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads or writes a fixed-length <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.bytes" title="vc2_conformance.bitstream.serdes.SerDes.bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> string from the
bitstream. This is a more convenient alternative to <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.nbits" title="vc2_conformance.bitstream.serdes.SerDes.nbits"><code class="xref py py-meth docutils literal notranslate"><span class="pre">nbits()</span></code></a> or
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.bitarray" title="vc2_conformance.bitstream.serdes.SerDes.bitarray"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bitarray()</span></code></a> when large blocks of data are to be read but not
treated as integers.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target for the value (as a <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.bytes" title="vc2_conformance.bitstream.serdes.SerDes.bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>).</p>
</dd>
<dt><strong>num_bits</strong><span class="classifier">int</span></dt><dd><p>The number of <em>bytes</em> (not bits) in the value.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl>
<dt><strong>value</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.bytes" title="vc2_conformance.bitstream.serdes.SerDes.bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.uint">
<code class="sig-name descname"><span class="pre">uint</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.uint" title="Permalink to this definition">¶</a></dt>
<dd><p>A variable-length, unsigned exp-golomb integer in a bitstream (as per
(A.4.3) read_uint()).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target for the value (as an <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>).</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>value</strong><span class="classifier">int</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.sint">
<code class="sig-name descname"><span class="pre">sint</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_bits</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.sint" title="Permalink to this definition">¶</a></dt>
<dd><p>A variable-length, signed exp-golomb integer in a bitstream (as per (A.4.4)
read_sint()).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target for the value (as an <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>).</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>value</strong><span class="classifier">int</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.byte_align">
<code class="sig-name descname"><span class="pre">byte_align</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.byte_align" title="Permalink to this definition">¶</a></dt>
<dd><p>Advance in the bitstream to the next whole byte boundary, if not already on
one (as per (A.2.4) byte_align()).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target for the padding bits (as a
<code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray.bitarray</span></code>).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.bounded_block_begin">
<code class="sig-name descname"><span class="pre">bounded_block_begin</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.bounded_block_begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the start of a bounded block (as per (A.4.2)). Must be followed
by a matching <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.bounded_block_end" title="vc2_conformance.bitstream.serdes.SerDes.bounded_block_end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bounded_block_end()</span></code></a>.</p>
<p>See also: <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.bounded_block" title="vc2_conformance.bitstream.serdes.SerDes.bounded_block"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bounded_block()</span></code></a>.</p>
<p>Bits beyond the end of the block are always ‘1’. If a ‘0’ is written
past the end of the block a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.9)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> will be thrown.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>length</strong><span class="classifier">int</span></dt><dd><p>The length of the bounded block in bits</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.bounded_block_end">
<code class="sig-name descname"><span class="pre">bounded_block_end</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.bounded_block_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the end of a bounded block (as per (A.4.2)). Must be proceeded
by a matching <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.bounded_block_begin" title="vc2_conformance.bitstream.serdes.SerDes.bounded_block_begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bounded_block_begin()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target name for any unused bits (as a
<code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray.bitarray</span></code>).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.bounded_block">
<code class="sig-name descname"><span class="pre">bounded_block</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">length</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.bounded_block" title="Permalink to this definition">¶</a></dt>
<dd><p>A context manager defining a bounded block (as per (A.4.2)).</p>
<p>See also: <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.bounded_block_begin" title="vc2_conformance.bitstream.serdes.SerDes.bounded_block_begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bounded_block_begin()</span></code></a>.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">serdes</span><span class="o">.</span><span class="n">bounded_block</span><span class="p">(</span><span class="s2">&quot;unused_bits&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target name for any unused bits (as a
<code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray.bitarray</span></code>).</p>
</dd>
<dt><strong>length</strong><span class="classifier">int</span></dt><dd><p>The length of the bounded block in bits</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.declare_list">
<code class="sig-name descname"><span class="pre">declare_list</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.declare_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Declares that the specified target should be treated as a
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a>.  Whenever this target is used in the future, values
will be read/written sequentially from the list.</p>
<p>This method has no impact on the bitstream.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The target name to be declared as a list.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.set_context_type">
<code class="sig-name descname"><span class="pre">set_context_type</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context_type</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.set_context_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Set (or change) the type of the current context dictionary.</p>
<p>This method has no impact on the bitstream.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>context_type</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>-like type</span></dt><dd><p>The desired type. If the context is already of the required type,
no change will be made. If the context is currently of a different
type, it will be passed to the <code class="docutils literal notranslate"><span class="pre">context_type</span></code> constructor and the
new type used in its place.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.subcontext_enter">
<code class="sig-name descname"><span class="pre">subcontext_enter</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.subcontext_enter" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates and/or enters a context dictionary within the specified
target of the current context dictionary. Must be followed later by a
matching <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.subcontext_leave" title="vc2_conformance.bitstream.serdes.SerDes.subcontext_leave"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subcontext_leave()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The name of the target in the current context in which the new
subcontext is/will be stored.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.subcontext_leave">
<code class="sig-name descname"><span class="pre">subcontext_leave</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.subcontext_leave" title="Permalink to this definition">¶</a></dt>
<dd><p>Leaves the current nested context dictionary entered by
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.subcontext_enter" title="vc2_conformance.bitstream.serdes.SerDes.subcontext_enter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subcontext_enter()</span></code></a>. Verifies that the closed dictionary has no
unused entries, throwing an appropriate exception if not.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.subcontext">
<code class="sig-name descname"><span class="pre">subcontext</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.subcontext" title="Permalink to this definition">¶</a></dt>
<dd><p>A Python context manager alternative to ;py:meth:<cite>subcontext_enter</cite> and
;py:meth:<cite>subcontext_leave</cite>.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">serdes</span><span class="o">.</span><span class="n">subcontext</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># ...</span>
</pre></div>
</div>
<p>Exactly equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">serdes</span><span class="o">.</span><span class="n">subcontext_enter</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">serdes</span><span class="o">.</span><span class="n">subcontext_leave</span><span class="p">():</span>
</pre></div>
</div>
<p>(But without the possibility of forgetting the
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.subcontext_leave" title="vc2_conformance.bitstream.serdes.SerDes.subcontext_leave"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subcontext_leave()</span></code></a> call).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The name of the target in the current context in which the new
subcontext is/will be stored.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.computed_value">
<code class="sig-name descname"><span class="pre">computed_value</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.computed_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Places a value into the named target in the current context, without
reading or writing anything into the bitstream. Any existing value in
the context will be overwritten.</p>
<p>This operation should be used sparingly to embed additional information
in a context dictionary which might be required to sensibly interpret
its contents and which cannot be trivially computed from the context
dictionary. For example, the number of transform coefficients in a
coded picture depends on numerous computations and table lookups using
earlier bitstream values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>target</strong><span class="classifier">str</span></dt><dd><p>The name of the target in the current context to store the value in.</p>
</dd>
<dt><strong>value</strong><span class="classifier">any</span></dt><dd><p>The value to be stored.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.is_target_complete">
<code class="sig-name descname"><span class="pre">is_target_complete</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.is_target_complete" title="Permalink to this definition">¶</a></dt>
<dd><p>Test whether a target in the current context is complete, i.e. has been
fully used up. Returns True if so, False otherwise.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.verify_complete">
<code class="sig-name descname"><span class="pre">verify_complete</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.verify_complete" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify that all values in the current context have been used and that
no bounded blocks or nested contexts have been left over.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnusedTargetError</span></code></dt><dd></dd>
<dt><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnclosedNestedContextError</span></code></dt><dd></dd>
<dt><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnclosedBoundedBlockError</span></code></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.context">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">context</span></code><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.context" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the top-level context dictionary.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.path">
<code class="sig-name descname"><span class="pre">path</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.path" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce a ‘path’ describing the part of the bitstream the parser is
currently processing.</p>
<p>If ‘target’ is None, only includes the path of the current nested context
dictionary. If ‘target’ is a target name in the current target
dictionary, the path to the last-used target will be included.</p>
<p>A path might look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;source_parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;frame_size&#39;</span><span class="p">,</span> <span class="s1">&#39;frame_width&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.serdes.SerDes.describe_path">
<code class="sig-name descname"><span class="pre">describe_path</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.SerDes.describe_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce a human-readable description of the part of the bitstream the
parser is currently processing.</p>
<p>If ‘target’ is None, prints only the path of the current nested context
dictionary. If ‘target’ is a target name in the current target
dictionary, this will be included in the string.</p>
<p>As a sample, a path might look like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SequenceHeader</span><span class="p">[</span><span class="s1">&#39;source_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;frame_size&#39;</span><span class="p">][</span><span class="s1">&#39;frame_width&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="vc2_conformance.bitstream.serdes.Serialiser">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">Serialiser</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">io</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.Serialiser" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.serdes.SerDes</span></code></a></p>
<p>A bitstream serialiser which, given a populated context dictionary, writes
the corresponding bitstream.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>io</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamWriter" title="vc2_conformance.bitstream.io.BitstreamWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamWriter</span></code></a></span></dt><dd></dd>
<dt><strong>context</strong><span class="classifier">dict</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="vc2_conformance.bitstream.serdes.Deserialiser">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">Deserialiser</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">io</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.Deserialiser" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.serdes.SerDes</span></code></a></p>
<p>A bitstream deserialiser which creates a context dictionary based on a
bitstream.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>io</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamReader" title="vc2_conformance.bitstream.io.BitstreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamReader</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="vc2_conformance.bitstream.serdes.MonitoredSerialiser">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">MonitoredSerialiser</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">monitor</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.MonitoredSerialiser" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.serdes.MonitoredMixin</span></code>, <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.serdes.Serialiser</span></code></a></p>
<p>Like <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a> but takes a ‘monitor’ function as the first
constructor argument. This function will be called every time bitstream
value has been serialised (written).</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>monitor</strong><span class="classifier">callable(ser, target, value)</span></dt><dd><p>A function which will be called after every primitive I/O operation
completes. This function is passed this <a class="reference internal" href="#vc2_conformance.bitstream.serdes.MonitoredSerialiser" title="vc2_conformance.bitstream.serdes.MonitoredSerialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">MonitoredSerialiser</span></code></a>
instance and the target name and value of the target just serialised.</p>
<p>This function may be used to inform a user of the current progress of
serialisation (e.g. using <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.describe_path" title="vc2_conformance.bitstream.serdes.SerDes.describe_path"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SerDes.describe_path()</span></code></a> or
<code class="xref py py-data docutils literal notranslate"><span class="pre">SerDes.io</span></code>) or to terminate serialisation early (by throwing
an exception).</p>
</dd>
<dt><strong>*args, **kwargs</strong><span class="classifier">see <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="vc2_conformance.bitstream.serdes.MonitoredDeserialiser">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">MonitoredDeserialiser</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">monitor</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.MonitoredDeserialiser" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.serdes.MonitoredMixin</span></code>, <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Deserialiser" title="vc2_conformance.bitstream.serdes.Deserialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.serdes.Deserialiser</span></code></a></p>
<p>Like <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Deserialiser" title="vc2_conformance.bitstream.serdes.Deserialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Deserialiser</span></code></a> but takes a ‘monitor’ function as the first
constructor argument. This function will be called every time bitstream
value has been deserialised (read).</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>monitor</strong><span class="classifier">callable(des, target, value)</span></dt><dd><p>A function which will be called after every primitive I/O operation
completes. This function is passed this
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.MonitoredDeserialiser" title="vc2_conformance.bitstream.serdes.MonitoredDeserialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">MonitoredDeserialiser</span></code></a> instance and the target name and
value of the target just serialised.</p>
<p>This function may be used to inform a user of the current progress of
deserialisation (e.g. using <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.context" title="vc2_conformance.bitstream.serdes.SerDes.context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SerDes.context()</span></code></a>,
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.describe_path" title="vc2_conformance.bitstream.serdes.SerDes.describe_path"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SerDes.describe_path()</span></code></a> or <code class="xref py py-data docutils literal notranslate"><span class="pre">SerDes.io</span></code>) or to
terminate deserialisation early (by throwing an exception).</p>
</dd>
<dt><strong>*args, **kwargs</strong><span class="classifier">see <a class="reference internal" href="#vc2_conformance.bitstream.serdes.Serialiser" title="vc2_conformance.bitstream.serdes.Serialiser"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serialiser</span></code></a></span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="vc2_conformance.bitstream.serdes.context_type">
<code class="sig-name descname"><span class="pre">context_type</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_type</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.serdes.context_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Syntactic sugar. A decorator for <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> which uses
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes.set_context_type" title="vc2_conformance.bitstream.serdes.SerDes.set_context_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SerDes.set_context_type()</span></code></a> to set the type of the current context
dict:</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@context_type</span><span class="p">(</span><span class="n">FrameSize</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">frame_size</span><span class="p">(</span><span class="n">serdes</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>Exactly equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">frame_size</span><span class="p">(</span><span class="n">serdes</span><span class="p">):</span>
    <span class="n">serdes</span><span class="o">.</span><span class="n">set_context_type</span><span class="p">(</span><span class="n">FrameSize</span><span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>The wrapped function must take a <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> as its first argument.</p>
<p>For introspection purposes, the wrapper function will be given a
‘context_type’ attribute holding the passed ‘dict_type’.</p>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="module-vc2_conformance.bitstream.io">
<span id="low-level-bitstream-io"></span><h2>Low-level bitstream IO<a class="headerlink" href="#module-vc2_conformance.bitstream.io" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#module-vc2_conformance.bitstream.io" title="vc2_conformance.bitstream.io"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.io</span></code></a> module contains low-level wrappers
for file-like objects which facilitate bitwise read and write operations of the
kinds used by VC-2’s bitstream format.</p>
<p>The <a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamReader" title="vc2_conformance.bitstream.io.BitstreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamReader</span></code></a> and <a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamWriter" title="vc2_conformance.bitstream.io.BitstreamWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamWriter</span></code></a> classes provide
equivalent methods for the various <code class="docutils literal notranslate"><span class="pre">read_*</span></code> pseudocode functions defined in
the VC-2 specification, along with a few additional utility methods.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These methods are designed to be ‘safe’ meaning that if out-of-range values
are provided an error will be produced (rather than an unexpected value
being written/read).</p>
</div>
<dl class="py class">
<dt id="vc2_conformance.bitstream.io.BitstreamReader">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">BitstreamReader</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader" title="Permalink to this definition">¶</a></dt>
<dd><p>An open file which may be read one bit at a time.</p>
<p>When the end-of-file is encountered, reads will result in a
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#EOFError" title="(in Python v3.9)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">EOFError</span></code></a>.</p>
<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.is_end_of_stream">
<code class="sig-name descname"><span class="pre">is_end_of_stream</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.is_end_of_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if we’ve reached the EOF. (A.2.5)</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.tell">
<code class="sig-name descname"><span class="pre">tell</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.tell" title="Permalink to this definition">¶</a></dt>
<dd><p>Report the current bit-position within the stream.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><dl class="simple">
<dt>(bytes, bits)</dt><dd><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code> is the offset of the current byte from the start of the
stream. <code class="docutils literal notranslate"><span class="pre">bits</span></code> is the offset in the current byte (starting at 7
(MSB) and advancing towards 0 (LSB) as bits are read).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.seek">
<code class="sig-name descname"><span class="pre">seek</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.seek" title="Permalink to this definition">¶</a></dt>
<dd><p>Seek to a specific (absolute) position in the file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>bytes</strong><span class="classifier">int</span></dt><dd><p>The byte-offset from the start of the file.</p>
</dd>
<dt><strong>bits</strong><span class="classifier">int</span></dt><dd><p>The bit offset into the specified byte to start reading from.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.bits_remaining">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">bits_remaining</span></code><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.bits_remaining" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of bits left in the current bounded block.</p>
<p>None, if not in a bounded block. Otherwise, the number of unused bits
remaining in the block. If negative, indicates the number of bits read
past the end of the block.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.bounded_block_begin">
<code class="sig-name descname"><span class="pre">bounded_block_begin</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.bounded_block_begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Begin a bounded block of the specified length in bits.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.bounded_block_end">
<code class="sig-name descname"><span class="pre">bounded_block_end</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.bounded_block_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Ends the current bounded block. Returns the number of unused bits
remaining, but does not read them or seek past them.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.read_bit">
<code class="sig-name descname"><span class="pre">read_bit</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.read_bit" title="Permalink to this definition">¶</a></dt>
<dd><p>Read and return the next bit in the stream. (A.2.3) Reads ‘1’ for
values past the end of file.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.read_nbits">
<code class="sig-name descname"><span class="pre">read_nbits</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bits</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.read_nbits" title="Permalink to this definition">¶</a></dt>
<dd><p>Read an ‘bits’-bit unsigned integer (like read_nbits (A.3.3)).</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.read_uint_lit">
<code class="sig-name descname"><span class="pre">read_uint_lit</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_bytes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.read_uint_lit" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a ‘num-bytes’ long integer (like read_uint_lit (A.3.4)).</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.read_bitarray">
<code class="sig-name descname"><span class="pre">read_bitarray</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bits</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.read_bitarray" title="Permalink to this definition">¶</a></dt>
<dd><p>Read ‘bits’ bits returning the value as a
<code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray.bitarray</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.read_bytes">
<code class="sig-name descname"><span class="pre">read_bytes</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_bytes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.read_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a number of bytes returning a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> string.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.read_uint">
<code class="sig-name descname"><span class="pre">read_uint</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.read_uint" title="Permalink to this definition">¶</a></dt>
<dd><p>Read an unsigned exp-golomb code (like read_uint (A.4.3)) and return an
integer.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.read_sint">
<code class="sig-name descname"><span class="pre">read_sint</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.read_sint" title="Permalink to this definition">¶</a></dt>
<dd><p>Signed version of <a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamReader.read_uint" title="vc2_conformance.bitstream.io.BitstreamReader.read_uint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read_uint()</span></code></a> (like read_sint (A.4.4)).</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamReader.try_read_bitarray">
<code class="sig-name descname"><span class="pre">try_read_bitarray</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bits</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamReader.try_read_bitarray" title="Permalink to this definition">¶</a></dt>
<dd><p>Attempt to read the next ‘bits’ bits from the bitstream file, leaving
any bounded blocks we might be in if necessary). May read fewer bits if
the end-of-file is encountered (but will not throw a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#EOFError" title="(in Python v3.9)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">EOFError</span></code></a>
like other methods of this class).</p>
<p>Intended for the display of error messages (i.e. as the final use of a
<a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamReader" title="vc2_conformance.bitstream.io.BitstreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamReader</span></code></a> instance) only since this method may (or
may not) exit the current bounded block as a side effect.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">BitstreamWriter</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter" title="Permalink to this definition">¶</a></dt>
<dd><p>An open file which may be written one bit at a time.</p>
<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.is_end_of_stream">
<code class="sig-name descname"><span class="pre">is_end_of_stream</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.is_end_of_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Always True. (A.2.5)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Strictly speaking this should return False when seeking to an
earlier part of the stream however this behaviour is not
implemented here for simplicity’s sake.</p>
</div>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.tell">
<code class="sig-name descname"><span class="pre">tell</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.tell" title="Permalink to this definition">¶</a></dt>
<dd><p>Report the current bit-position within the stream.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><dl class="simple">
<dt>(bytes, bits)</dt><dd><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code> is the offset of the current byte from the start of the
stream. <code class="docutils literal notranslate"><span class="pre">bits</span></code> is the offset in the current byte (starting at 7
(MSB) and advancing towards 0 (LSB) as bits are written).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.seek">
<code class="sig-name descname"><span class="pre">seek</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.seek" title="Permalink to this definition">¶</a></dt>
<dd><p>Seek to a specific (absolute) position in the file. Seeking to a given
byte will overwrite any bits already set in that byte to 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>bytes</strong><span class="classifier">int</span></dt><dd><p>The byte-offset from the start of the file.</p>
</dd>
<dt><strong>bits</strong><span class="classifier">int</span></dt><dd><p>The bit offset into the specified byte to start writing to.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.flush">
<code class="sig-name descname"><span class="pre">flush</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Ensure all bytes are committed to the file.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.bits_remaining">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">bits_remaining</span></code><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.bits_remaining" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of bits left in the current bounded block.</p>
<p>None, if not in a bounded block. Otherwise, the number of unused bits
remaining in the block. If negative, indicates the number of bits read
past the end of the block.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.bounded_block_begin">
<code class="sig-name descname"><span class="pre">bounded_block_begin</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.bounded_block_begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Begin a bounded block of the specified length in bits.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.bounded_block_end">
<code class="sig-name descname"><span class="pre">bounded_block_end</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.bounded_block_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Ends the current bounded block. Returns the number of unused bits
remaining, but does not write them or seek past them.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.write_bit">
<code class="sig-name descname"><span class="pre">write_bit</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.write_bit" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a bit into the bitstream. If in a bounded block, raises a
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.9)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> if a ‘0’ is written beyond the end of the block.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.write_nbits">
<code class="sig-name descname"><span class="pre">write_nbits</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.write_nbits" title="Permalink to this definition">¶</a></dt>
<dd><p>Write an ‘bits’-bit integer. The complement of read_nbits (A.3.3).</p>
<p>Throws an <code class="xref py py-exc docutils literal notranslate"><span class="pre">OutOfRangeError</span></code> if the value is too large to fit in
the requested number of bits.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.write_uint_lit">
<code class="sig-name descname"><span class="pre">write_uint_lit</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.write_uint_lit" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a ‘num-bytes’ long integer. The complement of read_uint_lit (A.3.4).</p>
<p>Throws an <code class="xref py py-exc docutils literal notranslate"><span class="pre">OutOfRangeError</span></code> if the value is too large to fit in
the requested number of bytes.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.write_bitarray">
<code class="sig-name descname"><span class="pre">write_bitarray</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.write_bitarray" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the ‘bits’ from the :py;class:<cite>bitarray.bitarray</cite> ‘value’.</p>
<p>Throws an <code class="xref py py-exc docutils literal notranslate"><span class="pre">OutOfRangeError</span></code> if the value is longer than ‘bits’.
The value will be right-hand zero-padded to the required length.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.write_bytes">
<code class="sig-name descname"><span class="pre">write_bytes</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.write_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the provided <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> in a python
bytestring.</p>
<p>If the provided byte string is too long an <code class="xref py py-exc docutils literal notranslate"><span class="pre">OutOfRangeError</span></code>
will be raised. If it is too short, it will be right-hand zero-padded.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.write_uint">
<code class="sig-name descname"><span class="pre">write_uint</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.write_uint" title="Permalink to this definition">¶</a></dt>
<dd><p>Write an unsigned exp-golomb code.</p>
<p>An <code class="xref py py-exc docutils literal notranslate"><span class="pre">OutOfRangeError</span></code> will be raised if a negative value is
provided.</p>
</dd></dl>

<dl class="py method">
<dt id="vc2_conformance.bitstream.io.BitstreamWriter.write_sint">
<code class="sig-name descname"><span class="pre">write_sint</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.BitstreamWriter.write_sint" title="Permalink to this definition">¶</a></dt>
<dd><p>Signed version of <a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamWriter.write_uint" title="vc2_conformance.bitstream.io.BitstreamWriter.write_uint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write_uint()</span></code></a>.</p>
</dd></dl>

</dd></dl>

<p>The following utility functions are also provided for converting between
offsets given as <code class="docutils literal notranslate"><span class="pre">(bytes,</span> <span class="pre">bits)</span></code> pairs and offsets given in bytes.</p>
<dl class="py function">
<dt id="vc2_conformance.bitstream.io.to_bit_offset">
<code class="sig-name descname"><span class="pre">to_bit_offset</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.to_bit_offset" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert from a (bytes, bits) tuple (as used by
<a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamReader.tell" title="vc2_conformance.bitstream.io.BitstreamReader.tell"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BitstreamReader.tell()</span></code></a> and <a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamWriter.tell" title="vc2_conformance.bitstream.io.BitstreamWriter.tell"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BitstreamWriter.tell()</span></code></a>) into a
total number of bits.</p>
</dd></dl>

<dl class="py function">
<dt id="vc2_conformance.bitstream.io.from_bit_offset">
<code class="sig-name descname"><span class="pre">from_bit_offset</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">total_bits</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.io.from_bit_offset" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert from a bit offset into a (bytes, bits) tuple (as used by
<a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamReader.tell" title="vc2_conformance.bitstream.io.BitstreamReader.tell"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BitstreamReader.tell()</span></code></a> and <a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamWriter.tell" title="vc2_conformance.bitstream.io.BitstreamWriter.tell"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BitstreamWriter.tell()</span></code></a>).</p>
</dd></dl>

</div>
<div class="section" id="module-vc2_conformance.bitstream.vc2_fixeddicts">
<span id="fixeddicts-and-pseudocode"></span><h2>Fixeddicts and pseudocode<a class="headerlink" href="#module-vc2_conformance.bitstream.vc2_fixeddicts" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#module-vc2_conformance.bitstream.vc2_fixeddicts" title="vc2_conformance.bitstream.vc2_fixeddicts"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.vc2_fixeddicts</span></code></a> module contains
<a class="reference internal" href="utility_modules/fixeddict.html#module-vc2_conformance.fixeddict" title="vc2_conformance.fixeddict"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fixeddict</span></code></a> definitions for holding VC-2 bitstream
values in a hierarchy which strongly mimics the bitstream structure. These
names are re-exported in the <a class="reference internal" href="#module-vc2_conformance.bitstream" title="vc2_conformance.bitstream"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream</span></code></a> module for
convenience. See <a class="reference internal" href="#bitstream-fixeddicts"><span class="std std-ref">Deserialised VC-2 bitstream data types</span></a> for a listing.</p>
<p>It also provides the following metadata structures:</p>
<dl class="py data">
<dt id="vc2_conformance.bitstream.vc2_fixeddicts.vc2_fixeddict_nesting">
<code class="sig-name descname"><span class="pre">vc2_fixeddict_nesting</span></code><a class="headerlink" href="#vc2_conformance.bitstream.vc2_fixeddicts.vc2_fixeddict_nesting" title="Permalink to this definition">¶</a></dt>
<dd><p>A lookup <code class="docutils literal notranslate"><span class="pre">{fixeddict_type:</span> <span class="pre">[fixeddict_type,</span> <span class="pre">...],</span> <span class="pre">...}</span></code>.</p>
<p>This lookup enumerates the fixeddicts which may be directly contained by the
fixed dictionary types in this module.</p>
<p>This hierarchical information is used by user-facing tools to allow (e.g.)
recursive selection of a particular dictionary to display.</p>
</dd></dl>

<dl class="py data">
<dt id="vc2_conformance.bitstream.vc2_fixeddicts.vc2_default_values">
<code class="sig-name descname"><span class="pre">vc2_default_values</span></code><a class="headerlink" href="#vc2_conformance.bitstream.vc2_fixeddicts.vc2_default_values" title="Permalink to this definition">¶</a></dt>
<dd><p>A lookup <code class="docutils literal notranslate"><span class="pre">{fixeddict_type:</span> <span class="pre">{key:</span> <span class="pre">default_value,</span> <span class="pre">...},</span> <span class="pre">...}</span></code></p>
<p>For each fixeddict type below, provides a sensible default value for each key.
The defaults are generally chosen to produce a minimal, but valid, bitstream.</p>
<p>Where a particular fixeddict entry is a list, the value listed in this lookup
should be treated as the default value to use for list entries.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For default values containing a <code class="xref py py-class docutils literal notranslate"><span class="pre">bitarray.bitarray</span></code> or any other
mutable type, users must take care to copy the default value before
mutating it.</p>
</div>
</dd></dl>

<span class="target" id="module-vc2_conformance.bitstream.vc2"></span><p>The <a class="reference internal" href="#module-vc2_conformance.bitstream.vc2" title="vc2_conformance.bitstream.vc2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.vc2</span></code></a> module contains a set of
<a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a>-using (see <a class="reference internal" href="#module-vc2_conformance.bitstream.serdes" title="vc2_conformance.bitstream.serdes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">serdes</span></code></a>)
functions which follow the pseudo-code in the VC-2 specification as closely as
possible. All pseudocode functions are re-exported by the
<a class="reference internal" href="#module-vc2_conformance.bitstream" title="vc2_conformance.bitstream"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream</span></code></a> module.</p>
<p>See the table in <a class="reference internal" href="#bitstream-fixeddicts"><span class="std std-ref">Deserialised VC-2 bitstream data types</span></a> which relates these functions to
their matching <a class="reference internal" href="utility_modules/fixeddict.html#module-vc2_conformance.fixeddict" title="vc2_conformance.fixeddict"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fixeddicts</span></code></a>.</p>
<p>In this module, all functions are derived from the pseudocode by:</p>
<ul class="simple">
<li><p>Replacing <code class="docutils literal notranslate"><span class="pre">read_*</span></code> calls with <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> calls.</p></li>
<li><p>Adding <a class="reference internal" href="#vc2_conformance.bitstream.serdes.SerDes" title="vc2_conformance.bitstream.serdes.SerDes"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code></a> annotations.</p></li>
<li><p>Removing of decoding functionality (retaining only the code required for
bitstream deserialisation).</p></li>
</ul>
<p>Consistency with the VC-2 pseudocode is checked by the test suite (see
<a class="reference internal" href="verification.html#module-verification" title="verification"><code class="xref py py-mod docutils literal notranslate"><span class="pre">verification</span></code></a>).</p>
</div>
<div class="section" id="module-vc2_conformance.bitstream.vc2_autofill">
<span id="autofill"></span><h2>Autofill<a class="headerlink" href="#module-vc2_conformance.bitstream.vc2_autofill" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#module-vc2_conformance.bitstream.vc2_autofill" title="vc2_conformance.bitstream.vc2_autofill"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.vc2_autofill</span></code></a> module provides auto-fill
routines for automatically computing certain values for the context
dictionaries used by the <a class="reference internal" href="#module-vc2_conformance.bitstream.vc2" title="vc2_conformance.bitstream.vc2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.vc2</span></code></a>
<a class="reference internal" href="#module-vc2_conformance.bitstream.serdes" title="vc2_conformance.bitstream.serdes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">serdes</span></code></a> functions. These values include the
picture number and parse offset fields which can’t default to a simple fixed
value.</p>
<p>In the common case, the <a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.autofill_and_serialise_stream" title="vc2_conformance.bitstream.vc2_autofill.autofill_and_serialise_stream"><code class="xref py py-func docutils literal notranslate"><span class="pre">autofill_and_serialise_stream()</span></code></a> function may
be used to serialise a complete <a class="reference internal" href="#vc2_conformance.bitstream.Stream" title="vc2_conformance.bitstream.Stream"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code></a>,
with sensible defaults provided for all fields (including picture numbers and
next/previous parse offsets).</p>
<dl class="py function">
<dt id="vc2_conformance.bitstream.vc2_autofill.autofill_and_serialise_stream">
<code class="sig-name descname"><span class="pre">autofill_and_serialise_stream</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stream</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.vc2_autofill.autofill_and_serialise_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a <code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code>
dictionary describing a VC-2 stream, serialise that into the supplied
file.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>file</strong><span class="classifier">file-like object</span></dt><dd><p>A file open for binary writing. The serialised bitstream will be
written to this file.</p>
</dd>
<dt><strong>stream</strong><span class="classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code></span></dt><dd><p>The stream to be serialised. Unspecified values will be auto-filled if
possible. See <a class="reference internal" href="#bitstream-fixeddicts"><span class="std std-ref">Deserialised VC-2 bitstream data types</span></a> for the default auto-fill
values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Internally, auto-fill values are taken from
<a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.vc2_default_values_with_auto" title="vc2_conformance.bitstream.vc2_autofill.vc2_default_values_with_auto"><code class="xref py py-data docutils literal notranslate"><span class="pre">vc2_default_values_with_auto</span></code></a>.</p>
<p>Supported fields containing the special value <a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.AUTO" title="vc2_conformance.bitstream.vc2_autofill.AUTO"><code class="xref py py-class docutils literal notranslate"><span class="pre">AUTO</span></code></a> will
be autofilled with suitably computed values. Specifically:</p>
<ul class="simple">
<li><p>Picture numbers will set to incrementing values (starting at 0,
or continuing from the value used by the previous picture) by
<a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.autofill_picture_number" title="vc2_conformance.bitstream.vc2_autofill.autofill_picture_number"><code class="xref py py-func docutils literal notranslate"><span class="pre">autofill_picture_number()</span></code></a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">major_version</span></code> field will be populated by
<a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.autofill_major_version" title="vc2_conformance.bitstream.vc2_autofill.autofill_major_version"><code class="xref py py-func docutils literal notranslate"><span class="pre">autofill_major_version()</span></code></a> and, if appropriate, extended
transform parameters fields will be removed.</p></li>
<li><p>Next and previous parse offsets will be calculated automatically
by
<a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.autofill_parse_offsets" title="vc2_conformance.bitstream.vc2_autofill.autofill_parse_offsets"><code class="xref py py-func docutils literal notranslate"><span class="pre">autofill_parse_offsets()</span></code></a>
and
<a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.autofill_parse_offsets_finalize" title="vc2_conformance.bitstream.vc2_autofill.autofill_parse_offsets_finalize"><code class="xref py py-func docutils literal notranslate"><span class="pre">autofill_parse_offsets_finalize()</span></code></a>.</p></li>
</ul>
</div>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<div class="section" id="autofill-value-routines">
<h3>Autofill value routines<a class="headerlink" href="#autofill-value-routines" title="Permalink to this headline">¶</a></h3>
<p>The following functions implement autofill routines for specific bitstream
values.</p>
<dl class="py function">
<dt id="vc2_conformance.bitstream.vc2_autofill.autofill_picture_number">
<code class="sig-name descname"><span class="pre">autofill_picture_number</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stream</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_picture_number</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.vc2_autofill.autofill_picture_number" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a <code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code>,
find all picture_number fields which are absent or contain the
<a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.AUTO" title="vc2_conformance.bitstream.vc2_autofill.AUTO"><code class="xref py py-data docutils literal notranslate"><span class="pre">AUTO</span></code></a> sentinel and automatically fill them with consecutive
picture numbers. Numbering is restarted for each sequence.</p>
</dd></dl>

<dl class="py function">
<dt id="vc2_conformance.bitstream.vc2_autofill.autofill_major_version">
<code class="sig-name descname"><span class="pre">autofill_major_version</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stream</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.vc2_autofill.autofill_major_version" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a <code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code>, find
all <code class="docutils literal notranslate"><span class="pre">major_version</span></code> fields which are set to the <a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.AUTO" title="vc2_conformance.bitstream.vc2_autofill.AUTO"><code class="xref py py-data docutils literal notranslate"><span class="pre">AUTO</span></code></a> sentinel
and automatically set them to the appropriate version number for the
features used by this stream.</p>
<p>As a side effect, this function will automatically remove the
<code class="xref py py-class docutils literal notranslate"><span class="pre">ExtendedTransformParameters</span></code>
field whenever it appears in
<code class="xref py py-class docutils literal notranslate"><span class="pre">TransformParameters</span></code>
if the major_version evaluates to less than 3. This change will only be
made when <code class="docutils literal notranslate"><span class="pre">major_version</span></code> was set to AUTO in a proceeding sequence
header, if the field was explicitly set to a particular value, no changes
will be made to any transform parameters dicts which follow.</p>
</dd></dl>

<dl class="py function">
<dt id="vc2_conformance.bitstream.vc2_autofill.autofill_parse_offsets">
<code class="sig-name descname"><span class="pre">autofill_parse_offsets</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stream</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.vc2_autofill.autofill_parse_offsets" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a <a class="reference internal" href="#vc2_conformance.bitstream.Stream" title="vc2_conformance.bitstream.Stream"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code></a>,
find and fill in all next_parse_offset and previous_parse_offset fields
which are absent or contain the <a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.AUTO" title="vc2_conformance.bitstream.vc2_autofill.AUTO"><code class="xref py py-data docutils literal notranslate"><span class="pre">AUTO</span></code></a> sentinel.</p>
<p>In many (but not all) cases computing these field values is most
straight-forwardly done post serialisation. In these cases, fields in the
stream will be autofilled with ‘0’. These fields should then subsequently
be ammended by <a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.autofill_parse_offsets_finalize" title="vc2_conformance.bitstream.vc2_autofill.autofill_parse_offsets_finalize"><code class="xref py py-func docutils literal notranslate"><span class="pre">autofill_parse_offsets_finalize()</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt id="vc2_conformance.bitstream.vc2_autofill.autofill_parse_offsets_finalize">
<code class="sig-name descname"><span class="pre">autofill_parse_offsets_finalize</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bitstream_writer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stream</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_parse_offsets_to_autofill</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">previous_parse_offsets_to_autofill</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vc2_conformance.bitstream.vc2_autofill.autofill_parse_offsets_finalize" title="Permalink to this definition">¶</a></dt>
<dd><p>Finalize the autofillling of next and previous parse offsets by directly
modifying the serialised bitstream.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>bitstream_writer</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamWriter" title="vc2_conformance.bitstream.io.BitstreamWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamWriter</span></code></a></span></dt><dd><p>A <a class="reference internal" href="#vc2_conformance.bitstream.io.BitstreamWriter" title="vc2_conformance.bitstream.io.BitstreamWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitstreamWriter</span></code></a> set up to
write to the already-serialised bitstream.</p>
</dd>
<dt><strong>stream</strong><span class="classifier"><a class="reference internal" href="#vc2_conformance.bitstream.Stream" title="vc2_conformance.bitstream.Stream"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code></a></span></dt><dd><p>The context dictionary used to serialies the bitstream. Since computed
values added to these dictionaries by the serialisation process, it may
be necessary to use the dictionary provided by
<code class="xref py py-attr docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.Serialiser.context</span></code>, rather than
the one passed into the Serialiser. This is because the Serialiser may
have replaced some dictionaries during serialisation.</p>
</dd>
<dt><strong>next_parse_offsets_to_autofill, previous_parse_offsets_to_autofill</strong></dt><dd><p>The arrays of parse info indices whose next and previous parse offsets
remain to be auto-filled.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="autofill-value-dictionary">
<h3>Autofill value dictionary<a class="headerlink" href="#autofill-value-dictionary" title="Permalink to this headline">¶</a></h3>
<dl class="py data">
<dt id="vc2_conformance.bitstream.vc2_autofill.vc2_default_values_with_auto">
<code class="sig-name descname"><span class="pre">vc2_default_values_with_auto</span></code><a class="headerlink" href="#vc2_conformance.bitstream.vc2_autofill.vc2_default_values_with_auto" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <code class="xref py py-data docutils literal notranslate"><span class="pre">vc2_conformance.bitstreams.vc2_default_values</span></code> but with
<a class="reference internal" href="#vc2_conformance.bitstream.vc2_autofill.AUTO" title="vc2_conformance.bitstream.vc2_autofill.AUTO"><code class="xref py py-data docutils literal notranslate"><span class="pre">AUTO</span></code></a> set as the default value for all fields which support it.</p>
</dd></dl>

<dl class="py data">
<dt id="vc2_conformance.bitstream.vc2_autofill.AUTO">
<code class="sig-name descname"><span class="pre">AUTO</span></code><a class="headerlink" href="#vc2_conformance.bitstream.vc2_autofill.AUTO" title="Permalink to this definition">¶</a></dt>
<dd><p>A constant which may be placed in a
<a class="reference internal" href="#module-vc2_conformance.bitstream.vc2_fixeddicts" title="vc2_conformance.bitstream.vc2_fixeddicts"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_fixeddicts</span></code></a> fixed dictionary field to
indicate that the various <code class="docutils literal notranslate"><span class="pre">autofill_*</span></code> functions in this module should
automatically compute a value for that field.</p>
</dd></dl>

</div>
</div>
<div class="section" id="module-vc2_conformance.bitstream.metadata">
<span id="metadata"></span><h2>Metadata<a class="headerlink" href="#module-vc2_conformance.bitstream.metadata" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#module-vc2_conformance.bitstream.metadata" title="vc2_conformance.bitstream.metadata"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.metadata</span></code></a> module contains metadata about
the relationship between VC-2 pseudocode functions and deserialised
<a class="reference internal" href="utility_modules/fixeddict.html#module-vc2_conformance.fixeddict" title="vc2_conformance.fixeddict"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fixeddict</span></code></a> structures. These are used by the
<a class="reference internal" href="cli/vc2_bitstream_viewer.html#vc2-bitstream-viewer"><span class="std std-ref">vc2-bitstream-viewer</span></a> command to produce richer output and during
documentation generation.</p>
<dl class="py data">
<dt id="vc2_conformance.bitstream.metadata.pseudocode_function_to_fixeddicts">
<code class="sig-name descname"><span class="pre">pseudocode_function_to_fixeddicts</span></code><a class="headerlink" href="#vc2_conformance.bitstream.metadata.pseudocode_function_to_fixeddicts" title="Permalink to this definition">¶</a></dt>
<dd><p>For the subset of pseudocode functions in the VC-2 spec dedicated to
serialisation/deserialisation, gives the corresponding fixeddict type in
<a class="reference internal" href="#module-vc2_conformance.bitstream.vc2_fixeddicts" title="vc2_conformance.bitstream.vc2_fixeddicts"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.vc2_fixeddicts</span></code></a>.</p>
<p>A dictionary of the shape <code class="docutils literal notranslate"><span class="pre">{function_name:</span> <span class="pre">[type,</span> <span class="pre">...],</span> <span class="pre">...}</span></code>.</p>
</dd></dl>

<dl class="py data">
<dt id="vc2_conformance.bitstream.metadata.pseudocode_function_to_fixeddicts_recursive">
<code class="sig-name descname"><span class="pre">pseudocode_function_to_fixeddicts_recursive</span></code><a class="headerlink" href="#vc2_conformance.bitstream.metadata.pseudocode_function_to_fixeddicts_recursive" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#vc2_conformance.bitstream.metadata.pseudocode_function_to_fixeddicts" title="vc2_conformance.bitstream.metadata.pseudocode_function_to_fixeddicts"><code class="xref py py-data docutils literal notranslate"><span class="pre">pseudocode_function_to_fixeddicts</span></code></a> but each entry also
recursively includes the fixeddict types of all contained entries.</p>
</dd></dl>

<dl class="py data">
<dt id="vc2_conformance.bitstream.metadata.fixeddict_to_pseudocode_function">
<code class="sig-name descname"><span class="pre">fixeddict_to_pseudocode_function</span></code><a class="headerlink" href="#vc2_conformance.bitstream.metadata.fixeddict_to_pseudocode_function" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a mapping from <a class="reference internal" href="#module-vc2_conformance.bitstream.vc2_fixeddicts" title="vc2_conformance.bitstream.vc2_fixeddicts"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream.vc2_fixeddicts</span></code></a> types to the name of the
corresponding pseudocode function which may be used to serialise/deserialise
from/to it.</p>
</dd></dl>

</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream</span></code>: Bitstream manipulation module</a><ul>
<li><a class="reference internal" href="#how-the-serialiser-deserialiser-module-is-used">How the serialiser/deserialiser module is used</a></li>
<li><a class="reference internal" href="#quick-start-guide">Quick-start guide</a><ul>
<li><a class="reference internal" href="#deserialised-bitstream-data-structures">Deserialised bitstream data structures</a></li>
<li><a class="reference internal" href="#serialising-bitstreams">Serialising bitstreams</a></li>
<li><a class="reference internal" href="#autofilling-bitstream-values">Autofilling bitstream values</a></li>
<li><a class="reference internal" href="#deserialising-bitstreams">Deserialising bitstreams</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deserialised-vc-2-bitstream-data-types">Deserialised VC-2 bitstream data types</a></li>
<li><a class="reference internal" href="#module-vc2_conformance.bitstream.serdes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">serdes</span></code>: A serialiser/deserialiser framework</a><ul>
<li><a class="reference internal" href="#a-basic-bitstream-serialiser">A basic bitstream serialiser</a></li>
<li><a class="reference internal" href="#a-basic-deserialiser">A basic deserialiser</a><ul>
<li><a class="reference internal" href="#an-introduction-to-the-serdes-interface">An introduction to the <code class="xref py py-class docutils literal notranslate"><span class="pre">SerDes</span></code> interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#verification">Verification</a></li>
<li><a class="reference internal" href="#representing-hierarchy">Representing hierarchy</a></li>
<li><a class="reference internal" href="#representing-arrays">Representing arrays</a></li>
<li><a class="reference internal" href="#computed-values">Computed values</a></li>
<li><a class="reference internal" href="#default-values-during-serialisation">Default values during serialisation</a><ul>
<li><a class="reference internal" href="#api">API</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-vc2_conformance.bitstream.io">Low-level bitstream IO</a></li>
<li><a class="reference internal" href="#module-vc2_conformance.bitstream.vc2_fixeddicts">Fixeddicts and pseudocode</a></li>
<li><a class="reference internal" href="#module-vc2_conformance.bitstream.vc2_autofill">Autofill</a><ul>
<li><a class="reference internal" href="#autofill-value-routines">Autofill value routines</a></li>
<li><a class="reference internal" href="#autofill-value-dictionary">Autofill value dictionary</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-vc2_conformance.bitstream.metadata">Metadata</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="encoder.html"
                        title="previous chapter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.encoder</span></code>: Internal VC-2 encoder</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="picture_generation/index.html"
                        title="next chapter">Test picture generation reference</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/bitstream.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="picture_generation/index.html" title="Test picture generation reference"
             >next</a> |</li>
        <li class="right" >
          <a href="encoder.html" title="vc2_conformance.encoder: Internal VC-2 encoder"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SMPTE VC-2 Conformance Software v1.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="xref py py-mod docutils literal notranslate"><span class="pre">vc2_conformance.bitstream</span></code>: Bitstream manipulation module</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, BBC.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.3.
    </div>
  </body>
</html>